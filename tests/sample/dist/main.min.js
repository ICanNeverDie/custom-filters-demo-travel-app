/*
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

define("app",[],function(){var e={};return _.extend(e,Backbone.Events,{router:null,mainView:null,defaultCard:"Splash View"})}),define("mobileui/utils/rect",[],function(){var e=function(){this._x=0,this._y=0,this._width=0,this._height=0};return e.prototype=_.extend({},Backbone.Events,{isEmpty:function(){return!this._width&&!this._height},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},right:function(){return this._x+this._width},bottom:function(){return this._y+this._height},setX:function(e){return this._x=e,this._changedPosition(),this},setY:function(e){return this._y=e,this._changedPosition(),this},setWidth:function(e){return this._width=e,this._changedSize(),this},setHeight:function(e){return this._height=e,this._changedSize(),this},setPosition:function(e,t){return this._x=e,this._y=t,this._changedPosition(),this},setSize:function(e,t){return this._width=e,this._height=t,this._changedSize(),this},set:function(e){var t=this._x!=e.x()||this._y!=e.y(),n=this._width!=e.width()||this._height!=e.height();if(!t&&!n)return;return this._x=e.x(),this._y=e.y(),this._width=e.width(),this._height=e.height(),t&&this.trigger("change:position"),n&&this.trigger("change:size"),this.trigger("change"),this},alignRight:function(e){return this.setX(e-this.width())},alignBottom:function(e){return this.setY(e-this.height())},_changedPosition:function(){this.trigger("change:position"),this.trigger("change")},_changedSize:function(){this.trigger("change:size"),this.trigger("change")}}),e}),define("mobileui/utils/transform",[],function(){function e(e){return _.map(e,function(e,t){return t})}function t(e,t,n,r,i){_.isArray(t)||(t=t.split(" "));var s=i?i(t):_.map(t,function(e){return"_"+e}),o=function(){var e=this,n=arguments;_.each(t,function(t,r){e[s[r]]=r<n.length?n[r]:0})};return _.extend(o,{create:function(){var e=new o,n=arguments;return _.each(t,function(t,r){e[s[r]]=r<n.length?n[r]:0}),e}}),_.extend(o.prototype,Backbone.Events,{type:o,is3DTransform:r,toString:function(){var r=this,i=[];return _.each(t,function(e,t){i.push(r[s[t]].toFixed(6)+n)}),e+"("+i.join(", ")+")"},blend:function(e,n){var r=new o,i=this;return _.each(t,function(t,o){r[s[o]]=i[s[o]]*(1-e)+n[s[o]]*e}),r},multiply:function(e){var n=new o,r=this;return _.each(t,function(t,i){n[s[i]]=r[s[i]]*e}),n},clone:function(){var e=new o,n=this;return _.each(t,function(t,r){e[s[r]]=n[s[r]]}),e},_onValueChanged:function(){this.trigger("change")}}),_.each(t,function(e,t){o.prototype["set"+_.string.capitalize(e)]=function(e){return e==this[s[t]]?this:(this[s[t]]=e,this._onValueChanged(),this)},o.prototype["add"+_.string.capitalize(e)]=function(e){return this[s[t]]+=e,this._onValueChanged(),this},o.prototype["mul"+_.string.capitalize(e)]=function(e){return this[s[t]]*=e,this._onValueChanged(),this},o.prototype[e]=function(){return this[s[t]]}}),o}function s(e,t,n,r){var i=e/2,s=Math.sin(i),o=s*Math.cos(i),u=s*s;return Matrix.create([[1-2*(n*n+r*r)*u,2*(t*n*u-r*o),2*(t*r*u+n*o),0],[2*(t*n*u+r*o),1-2*(t*t+r*r)*u,2*(n*r*u-t*u),0],[2*(t*r*u-n*o),2*(n*r*u+t*o),1-2*(t*t+n*n)*u,0],[0,0,0,1]])}function o(e,t){return s(e,t[0],t[1],t[2])}var n={rotate:t("rotate","angle","deg",!1),rotateX:t("rotateX","angle","deg",!0),rotateY:t("rotateY","angle","deg",!0),rotateZ:t("rotateZ","angle","deg",!1),translate:t("translate","x y","px",!1),translateX:t("translateX","x","px",!1),translateY:t("translateY","y","px",!1),translateZ:t("translateZ","z","px",!0),translate3d:t("translate3d","x y z","px",!0),scale:t("scale","x y","",!1),perspective:t("perspective","depth","",!0),matrix:t("matrix","a b c d e f","",!1,e),matrix3d:t("matrix3d","a11 a21 a31 a41 a21 a22 a23 a24 a31 a32 a33 a34 a41 a42 a43 a44","",!0,e)},r=function(){if(!(this instanceof r))return new r;this._data=[]};return _.extend(r.prototype,Backbone.Events,{search:function(e){_.isString(e)&&(e=n[e]);var t=this._data;for(var r=0;r<t.length;++r)if(t[r].type===e)return t[r];return null},get:function(e){_.isString(e)&&(e=n[e]);var t=this.search(e);return t||(t=e.create(),this.append(t)),t},isEmpty:function(){return!this._data.length},append:function(e){return e.on("change",this._onFunctionValueChange,this),this._data.push(e),this._onFunctionValueChange(),this},insert:function(e,t){return e.on("change",this._onFunctionValueChange,this),this._data.splice(t,0,e),this._onFunctionValueChange(),this},remove:function(e){var t=this._data.indexOf(e);return t==-1?this:(e.off("change",this._onFunctionValueChange,this),this._data.splice(i,1),this._onFunctionValueChange(),this)},clear:function(){return _.each(this._data,function(e){e.off("change",self._onFunctionValueChange,self)}),this._data=[],this._onFunctionValueChange(),this},set:function(e){var t=this;_.each(this._data,function(e){e.off("change",t._onFunctionValueChange,t)}),this._data=[],_.each(e._data,function(e){t.append(e.clone())}),this._onFunctionValueChange()},take:function(e){var t=this;_.each(this._data,function(e){e.off("change",t._onFunctionValueChange,t)}),this._data=e._data,e._data=[],_.each(this._data,function(n){n.off("change",e._onFunctionValueChange,e),n.on("change",t._onFunctionValueChange,t)}),e._onFunctionValueChange(),this._onFunctionValueChange()},has3DTransforms:function(){return _.some(this._data,function(e,t){return e.is3DTransform})},toString:function(){return this._data.join(" ")},toMatrix:function(){var e=Matrix.I(4);return _.each(this._data,function(t){e=e.multiply(t.toMatrix())}),e},toMatrix3d:function(){return r.matrix3d.fromMatrix(this.toMatrix())},_onFunctionValueChange:function(){this.trigger("change")},clone:function(){var e=new r;return _.each(this._data,function(t){e.append(t.clone())}),e},canBlendFunctionsWith:function(e){return e._data.length!=this._data.length?!1:_.every(this._data,function(t,n){return t.type===e._data[n].type})},_fromZeroBlend:function(e,t){var n=new r;return _.each(t._data,function(t,r){n.append(t.multiply(e))}),n},_toZeroBlend:function(e){var t=new r;return _.each(this._data,function(n,r){t.append(n.multiply(e))}),t},blend:function(e,t){if(!this._data.length)return this._fromZeroBlend(e,t);if(!t._data.length)return this._toZeroBlend(1-e);var i=new r;if(this.canBlendFunctionsWith(t))_.each(this._data,function(n,r){i.append(n.blend(e,t._data[r]))});else{var s=new n.matrix3d;s.fromMatrix(this.toMatrix3d().multiply(e).add(t.toMatrix3d().multiply(1-e))),i.append(s)}return i},concat:function(e){var t=new r;return _.each(this._data,function(e){t.append(e)}),_.each(e._data,function(e){t.append(e)}),t}}),_.extend(r,n,{rads:function(e){return e*Math.PI/180},degs:function(e){return e*180/Math.PI}}),_.each(n,function(e,t){r.prototype[t]=function(){var t=e.create.apply(null,Array.prototype.slice.call(arguments));return this.append(t),this}}),_.extend(r.rotate.prototype,{vector:[0,0,1],toMatrix:function(){return o(r.rads(this.angle()),this.vector)}}),_.extend(r.rotateX.prototype,{vector:[1,0,0],toMatrix:function(){return o(r.rads(this.angle()),this.vector)}}),_.extend(r.rotateY.prototype,{vector:[0,1,0],toMatrix:function(){return o(r.rads(this.angle()),this.vector)}}),_.extend(r.rotateZ.prototype,{vector:[0,0,1],toMatrix:function(){return o(r.rads(this.angle()),this.vector)}}),_.extend(r.translate.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,this.x()],[0,1,0,this.y()],[0,0,1,0],[0,0,0,1]])}}),_.extend(r.translateX.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,this.x()],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}}),_.extend(r.translateY.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,0],[0,1,0,this.y()],[0,0,1,0],[0,0,0,1]])}}),_.extend(r.translateZ.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,0],[0,1,0,0],[0,0,1,this.z()],[0,0,0,1]])}}),_.extend(r.translate3d.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,this.x()],[0,1,0,this.y()],[0,0,1,this.z()],[0,0,0,1]])}}),_.extend(r.perspective.prototype,{toMatrix:function(){return Matrix.create([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,-1/this.depth(),1]])}}),_.extend(r.scale.prototype,{toMatrix:function(){return Matrix.create([[this.x(),0,0,0],[0,this.y(),0,0],[0,0,1,0],[0,0,0,1]])}}),_.extend(r.matrix3d.prototype,{toMatrix:function(){return Matrix.create([[this.a(),this.c(),0,this.e()],[this.b(),this.d(),0,this.f()],[0,0,1,0],[0,0,0,1]])},fromMatrix:function(e){return this.setA(e.e(1,1)).setB(e.e(2,1)).setC(e.e(1,2)).setD(e.e(2,2)).setE(e.e(1,4)).setF(e.e(2,4)),this}}),r.matrix.fromMatrix=function(e){var t=new r.matrix;return t.fromMatrix(e),t},_.extend(r.matrix3d.prototype,{toMatrix:function(){return Matrix.create([[this.a11(),this.a12(),this.a13(),this.a14()],[this.a21(),this.a22(),this.a23(),this.a24()],[this.a31(),this.a32(),this.a33(),this.a34()],[this.a41(),this.a42(),this.a43(),this.a44()]])},fromMatrix:function(e){var t=0,n=!1;for(var r=1;r<=4;++r)for(var i=1;i<=4;++i,t++){var s=e.e(i,r);if(this[t]==s)continue;this[t]=s,n=!0}return this.changed&&this._onValueChanged(),this}}),r.matrix3d.fromMatrix=function(e){var t=new r.matrix3d;return t.fromMatrix(e),t},r}),define("mobileui/utils/filter",[],function(){function e(e){return function(t,n){var r=0;return _.map(e,function(e){return e.charAt(0)=="?"?t[n[r++]].toFixed(6):e}).join("")}}function t(e,t,n){_.isArray(t)||(t=t.split(" "));var r;_.isFunction(n)&&(r=n);var i=_.map(t,function(e){return"_"+e}),s=function(){var e=this,n=arguments;_.each(t,function(t,r){e[i[r]]=r<n.length?n[r]:0})};return _.extend(s,{create:function(){var e=new s,n=arguments;return _.each(t,function(t,r){e[i[r]]=r<n.length?n[r]:0}),e}}),_.extend(s.prototype,Backbone.Events,{type:s,toString:function(){if(r)return r(this,i);var s=this,o=[];return _.each(t,function(e,t){o.push(s[i[t]].toFixed(6)+n)}),e+"("+o.join(", ")+")"},blend:function(e,n){var r=new s,o=this;return _.each(t,function(t,s){var u=o[i[s]];if(_.isString(u)){r[i[s]]=u;return}r[i[s]]=u*(1-e)+n[i[s]]*e}),r},multiply:function(e){var n=new s,r=this;return _.each(t,function(t,s){n[i[s]]=r[i[s]]*e}),n},clone:function(){var e=new s,n=this;return _.each(t,function(t,r){e[i[r]]=n[i[r]]}),e},_onValueChanged:function(){this.trigger("change")}}),_.each(t,function(e,t){s.prototype["set"+_.string.capitalize(e)]=function(e){return e==this[i[t]]?this:(this[i[t]]=e,this._onValueChanged(),this)},s.prototype["add"+_.string.capitalize(e)]=function(e){return this[i[t]]+=e,this._onValueChanged(),this},s.prototype["mul"+_.string.capitalize(e)]=function(e){return this[i[t]]*=e,this._onValueChanged(),this},s.prototype[e]=function(){return this[i[t]]}}),s}function s(e,t){r.prototype[e]=function(){var e=t.create.apply(null,Array.prototype.slice.call(arguments));return this.append(e),this}}function o(e,t){var n=document.createElement("div").style;if(r.camelCasePropertyName in n){n[r.camelCasePropertyName]=e;var i=n[r.camelCasePropertyName];return i?t.test(i):!1}return!1}var n={blur:t("blur","radius","px"),brightness:t("brightness","intensity","%"),grayscale:t("grayscale","intensity","%"),opacity:t("opacity","intensity","%"),dropShadow:t("drop-shadow","x y radius color",function(e){return"drop-shadow("+e._x.toFixed(6)+"px "+e._y.toFixed(6)+"px "+e._radius.toFixed(6)+"px rgba(0, 0, 0, "+e._color+"))"})},r=function(){if(!(this instanceof r))return new r;this._data=[]};return _.extend(r.prototype,Backbone.Events,{search:function(e){_.isString(e)&&(e=n[e]);var t=this._data;for(var r=0;r<t.length;++r)if(t[r].type===e)return t[r];return null},get:function(e){_.isString(e)&&(e=n[e]);var t=this.search(e);return t||(t=e.create(),this.append(t)),t},isEmpty:function(){return!this._data.length},append:function(e){return e.on("change",this._onFunctionValueChange,this),this._data.push(e),this._onFunctionValueChange(),this},insert:function(e,t){return e.on("change",this._onFunctionValueChange,this),this._data.splice(t,0,e),this._onFunctionValueChange(),this},remove:function(e){var t=this._data.indexOf(e);return t==-1?this:(e.off("change",this._onFunctionValueChange,this),this._data.splice(i,1),this._onFunctionValueChange(),this)},clear:function(){return _.each(this._data,function(e){e.off("change",self._onFunctionValueChange,self)}),this._data=[],this._onFunctionValueChange(),this},set:function(e){var t=this;_.each(this._data,function(e){e.off("change",t._onFunctionValueChange,t)}),this._data=[],_.each(e._data,function(e){t.append(e.clone())}),this._onFunctionValueChange()},take:function(e){var t=this;_.each(this._data,function(e){e.off("change",t._onFunctionValueChange,t)}),this._data=e._data,e._data=[],_.each(this._data,function(n){n.off("change",e._onFunctionValueChange,e),n.on("change",t._onFunctionValueChange,t)}),e._onFunctionValueChange(),this._onFunctionValueChange()},toString:function(){return this._data.join(" ")},toMatrix:function(){var e=Matrix.I(4);return _.each(this._data,function(t){e=e.multiply(t.toMatrix())}),e},toMatrix3d:function(){return r.matrix3d.fromMatrix(this.toMatrix())},_onFunctionValueChange:function(){this.trigger("change")},clone:function(){var e=new r;return _.each(this._data,function(t){e.append(t.clone())}),e},canBlendFunctionsWith:function(e){return e._data.length!=this._data.length?!1:_.every(this._data,function(t,n){return t.type===e._data[n].type})},_fromZeroBlend:function(e,t){var n=new r;return _.each(t._data,function(t,r){n.append(t.multiply(e))}),n},_toZeroBlend:function(e){var t=new r;return _.each(this._data,function(n,r){t.append(n.multiply(e))}),t},blend:function(e,t){if(!this._data.length)return this._fromZeroBlend(e,t);if(!t._data.length)return this._toZeroBlend(1-e);var n=new r;return this.canBlendFunctionsWith(t)&&_.each(this._data,function(r,i){n.append(r.blend(e,t._data[i]))}),n},concat:function(e){var t=new r;return _.each(this._data,function(e){t.append(e)}),_.each(e._data,function(e){t.append(e)}),t}}),_.extend(r,n,{registerCustomFilter:function(e,r,i){var o=n[e]=t(e,r,i);return s(e,o),o},createCustomFilterGenerator:e,propertyName:PrefixFree.prefixProperty("filter"),camelCasePropertyName:PrefixFree.prefixProperty("filter",!0)}),r.supportsCustomFilters=o("custom(url(empty))",/^custom\(/),_.each(n,function(e,t){s(t,e)}),r}),define("mobileui/utils/outsets",[],function(){var e=function(){this._left=0,this._top=0,this._right=0,this._bottom=0};return e.prototype=_.extend({},Backbone.Events,{left:function(){return this._left},top:function(){return this._top},right:function(){return this._right},bottom:function(){return this._bottom},horizontal:function(){return this._left+this._right},vertical:function(){return this._top+this._bottom},setLeft:function(e){return this._left=e,this._changedHorizontal(),this},setRight:function(e){return this._right=e,this._changedHorizontal(),this},setTop:function(e){return this._top=e,this._changedVertical(),this},setBottom:function(e){return this._bottom=e,this._changedVertical(),this},setAll:function(e){var t=this._left!=e||this._right!=e,n=this._top!=e||this._bottom!=e;if(!t&&!n)return;return this._left=e,this._right=e,this._top=e,this._bottom=e,t&&this.trigger("change:vertical"),n&&this.trigger("change:horizontal"),this.trigger("change"),this},set:function(e){var t=this._left!=e.left()||this._right!=e.right(),n=this._top!=e.top()||this._bottom!=e.bottom();if(!t&&!n)return;return this._left=bounds.left(),this._right=bounds.right(),this._top=bounds.top(),this._bottom=bounds.bottom(),t&&this.trigger("change:vertical"),n&&this.trigger("change:horizontal"),this.trigger("change"),this},toCSSString:function(e){return[this._top+e,this._right+e,this._bottom+e,this._left+e].join(" ")},_changedHorizontal:function(){this.trigger("change:horizontal"),this.trigger("change")},_changedVertical:function(){this.trigger("change:vertical"),this.trigger("change")}}),e}),define("mobileui/utils/boilerplate",[],function(){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){var r=Array.prototype.concat.call(n,Array.prototype.slice.call(arguments,0));t.apply(e,r)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;++t)if(this[t]==e)return t;return-1}),window.console||(window.console={error:function(){},log:function(){}});var e=null,t=function(n){var r=window.getComputedStyle(document.body),i=/^-(webkit|moz|ms|o)-(.*)$/,s={},o,u;for(o=0;o<r.length;++o){u=r[o];if(i.test(u)){var a=u.match(i);s[a[2]]=u,e||(e=a[1])}}if(e)for(o=0;o<n.length;++o)u=n[o],s[u]="-"+e+"-"+u;return s}(["transition"]),n={webkit:"WebKit",moz:"Moz",ms:"Ms"};return{lookupPrefix:function(t,n){return t[n]||t[e+_.string.capitalize(n)]},lookupUpperCasePrefix:function(t,r){return t[r]||t[n[e]+r]},prefixValue:function(t){return e?"-"+e+"-"+t:t},prefixOne:function(e){var n=t[e];return n?n:e},prefix:function(e){var t={};return $.each(e,function(e,n){t[Global.Utils.prefixOne(e)]=n}),t}}}),define("mobileui/utils/time",["mobileui/utils/boilerplate"],function(e){var t=function(){return Date.now()},n=e.lookupPrefix(window,"performance");if(n){var r=e.lookupPrefix(n,"now");r&&(t=function(){return r.call(n)})}return{now:t}}),define("mobileui/utils/request-animation-frame",["mobileui/utils/boilerplate"],function(e){function s(){i.trigger("layout"),i.trigger("animation");while(n&&n.length){var e=n;n=null,_.each(e,function(e){e()})}r=!1,i.trigger("after")}var t=e.lookupPrefix(window,"requestAnimationFrame");t||(t=function(e){return setTimeout(e,0)});var n=null,r=!1,i=_.extend(function(e){n||(n=[],t(s)),e&&n.push(e)},Backbone.Events,{run:function(){i(null)},setHadDOMUpdates:function(){r=!0},runInlinesIfNeeded:function(){r&&s()}});return i}),define("mobileui/utils/animation-controller",["mobileui/utils/time","mobileui/utils/request-animation-frame"],function(e,t){var n=1e3/60,r=function(){this.time=-1,this.previousTime=-1,this._nextInterval=-1,this._setStarted=!1,this._stateValues={},this._pendingCommit=!1};_.extend(r.prototype,{updateTime:function(){this.previousTime=this.time,this.time=e.now(),this.delta=this.previousTime>=0?this.time-this.previousTime:0,this._nextInterval=-1},prepareSet:function(){this._setStarted=!1},isSetActive:function(){return this._setStarted},nextInterval:function(){return this._nextInterval==-1?-1:Math.max(0,this._nextInterval-(e.now()-this.time))},requestFrame:function(){this.requestTimer(n)},requestImmediateFrame:function(){this.requestTimer(0)},requestTimer:function(e){if(e<0)throw new Error("Invalid interval value "+e);this._setStarted=!0;if(this._nextInterval==-1){this._nextInterval=e;return}this._nextInterval=Math.min(this._nextInterval,e)},requestFixedTimer:function(e){this._setStarted=!0,this.requestTimer(e,this.time)},set:function(e,t){this._stateValues[e]=t},get:function(e,t){return this._stateValues[e]},remove:function(e){delete this._stateValues[e]}});var i=function(){this._animations=[],this._state=new r,this._lastAnimationId=0,this._nextTimerId=null,this._nextTimerInterval=-1,this._timerCallbak=this._onTimerFired.bind(this),this._inCompute=!1,this._hasRemovedSet=!1};return _.extend(i.prototype,Backbone.Events,{allocateAnimationId:function(){return++this._lastAnimationId},register:function(e){return this._animations.indexOf(e)!=-1?!1:(this._animations.push(e),e.on("change:animation",this._onAnimationPropertyChanged,this),this._onAnimationPropertyChanged(),!0)},unregister:function(e){var t=this._animations.indexOf(e);return t==-1?!1:(e.off("change:animation",this._onAnimationPropertyChanged,this),this._inCompute?(this._animations[t]=null,this._hasRemovedSet=!0):this._animations.splice(t,1),this._onAnimationPropertyChanged(),!0)},_setTimer:function(e){if(this._nextTimerInterval!=-1&&this._nextTimerInterval<=e)return;this._nextTimerId&&(clearTimeout(this._nextTimerId),this._nextTimerId=null,this._nextTimerInterval=-1);if(e==-1)return;this._nextTimerInterval=e,this._nextTimerId=setTimeout(this._timerCallbak,e)},_onTimerFired:function(){this._nextTimerInterval=-1,this._nextTimerId=null,this.compute()},_onAnimationPropertyChanged:function(){if(this._pendingCommit||this._inCompute)return;this._setTimer(0)},_cleanupSets:function(){this._animations=_.filter(this._animations,function(e){return!!e}),this._hasRemovedSet=!1},compute:function(){this._pendingCommit=!1,this._inCompute=!0;var e=this._state;do{e.updateTime();var t=this._animations;for(var n=0;n<t.length;++n){var r=t[n];r&&r.compute(e)}}while(!e.nextInterval());this._hasRemovedSet&&this._cleanupSets(),this._setTimer(e.nextInterval()),this._inCompute=!1},runOnRequestAnimationFrame:function(){if(this._pendingCommit)return;this._pendingCommit=!0,t.once("animation",this.compute,this).run(),this._setTimer(-1)}}),i.instance=new i,i}),define("mobileui/utils/animation",["mobileui/utils/animation-controller"],function(e){var t=function(t){this._id=e.instance.allocateAnimationId(),this.name=t,this._animations=[],this._stoppedAnimations=null};return _.extend(t.prototype,Backbone.Events,{compute:function(e,t){_.each(this._animations,function(n){n.compute(e,t)});if(this._stoppedAnimations){var n=this._stoppedAnimations;this._stoppedAnimations=null;var r=this;_.each(n,function(t){r._removeStoppedAnimation(t,e)})}},search:function(e){return _.find(this._animations,function(t){return t.name==e})},get:function(e){var n=this.search(e);return n||(n=new t(e),this.append(n)),n},unset:function(e){var t=this.search(e);t&&this.remove(t)},_injectAnimation:function(e){e.on("change:animation",this._onAnimationPropertyChange,this),e.once("stop",this._onAnimationStopped.bind(this,e)),this._onAnimationPropertyChange()},append:function(e){return this._animations.push(e),this._injectAnimation(e),this},insert:function(e,t){return this._animations.splice(t,0,e),this._injectAnimation(e),this},remove:function(e){var t=this._animations.indexOf(e);if(t==-1)return;return this._internalRemove(t),this},removeAll:function(){return _.each(this._animations,function(e){e.off("change:animation",this._onAnimationPropertyChange,this)}),this._animations=[],this},_internalRemove:function(e){var t=this._animations[e];this._animations.splice(e,1),t.off("change:animation",this._onAnimationPropertyChange,this),this._onAnimationPropertyChange()},_onAnimationStopped:function(e){this._stoppedAnimations||(this._stoppedAnimations=[]),this._stoppedAnimations.push(e)},_removeStoppedAnimation:function(e,t){var n=this._animations.indexOf(e);if(n==-1)return;this._internalRemove(n);var r=e.next();if(!r)return;this.insert(r,n),t.requestImmediateFrame()},_onAnimationPropertyChange:function(){this.trigger("change:animation")},last:function(){return this._animations.length?this._animations[this._animations.length-1]:null},chain:function(e){var t=require("mobileui/utils/basic-animation"),n=(new t("start")).setDuration(e!==undefined?e:0);return this._animations.length?this.last().setNext(n):this.append(n),n},promise:function(){var e=this,t=$.Deferred();return this.once("stop",function(){t.resolveWith(e)}),t.promise()}}),t}),define("mobileui/utils/timing-functions",[],function(){function e(e,t,n,r){function l(e){return((o*e+s)*e+i)*e}function c(e){return((f*e+a)*e+u)*e}function h(e){return(3*o*e+2*s)*e+i}function p(e,t){var n,r,i,s,o,u;for(i=e,u=0;u<8;u++){s=l(i)-e;if(Math.abs(s)<t)return i;o=h(i);if(Math.abs(o)<1e-6)break;i-=s/o}n=0,r=1,i=e;if(i<n)return n;if(i>r)return r;while(n<r){s=l(i);if(Math.abs(s-e)<t)return i;e>s?n=i:r=i,i=(r-n)*.5+n}return i}function d(e){return 1/(200*e)}var i=3*e,s=3*(n-e)-i,o=1-i-s,u=3*t,a=3*(r-t)-u,f=1-u-a;return function(e,t){return c(p(e,d(t)))}}return{cubicBezier:e,ease:e(.25,.1,.25,1),linear:e(0,0,1,1),easeIn:e(.42,0,1,1),easeOut:e(0,0,.58,1),easeInOut:e(.42,0,.58,1)}}),define("mobileui/utils/basic-animation",["mobileui/utils/animation","require","mobileui/utils/timing-functions"],function(e,t,n){var r=function(e){this.startTime=e,this.playDuration=0,this.percent=0,this.started=!0},i=function(t){e.call(this,t),this._duration=-1,this._next=null,this._timingFunction=n.linear};return _.extend(i.prototype,Backbone.Events,{compute:function(e,t){var n=e.get(this._id);n||(n=new r(e.time),e.set(this._id,n),this._internalStart(e,t,n),this.trigger("start")),n.playDuration=e.time-n.startTime,this._duration>=0&&(n.percent=this._duration?n.playDuration/this._duration:1,n.percent>=1?(n.timingFunctionPercent=1,n.percent=1,e.remove(this._id),n.started=!1):n.timingFunctionPercent=this._timingFunction(n.percent,this._duration)),this._internalCompute(e,t,n),n.started||this.trigger("stop")},setTimingFunction:function(e){return _.isString(e)&&(e=n[e]),this._timingFunction=e,this},_internalStart:function(e,t,n){},_internalCompute:function(e,t,n){n.started&&e.requestTimer(this._duration-n.playDuration)},setDuration:function(e){return this._duration=e,this},duration:function(){return this._duration},setNext:function(e){return this._next=e,this},next:function(){return this._next},wait:function(e){return this.setNext((new i("wait "+e)).setDuration(e)).next()},log:function(e){return this.setNext((new i("log "+e)).setDuration(0).on("stop",function(){console.log("animation: ",e)})).next()},callback:function(e){return this.setNext((new i("callback")).setDuration(0).on("stop",e)).next()},transform:function(e,n,r){r||(r=n,n=null);var i=t("mobileui/utils/transform-animation"),s=new i("transform");return s.getTransform().take(r),n&&s.startTransform().take(n),this.setNext(s.setDuration(e)).next()},filter:function(e,n,r){r||(r=n,n=null);var i=t("mobileui/utils/filter-animation"),s=new i("filter");return s.getFilter().take(r),n&&s.startFilter().take(n),this.setNext(s.setDuration(e)).next()},opacity:function(e,n,r){r===undefined&&(r=n,n=null);var i=t("mobileui/utils/opacity-animation"),s=new i("opacity");return s.setOpacity(r),n!==null&&s.setStartOpacity(n),this.setNext(s.setDuration(e)).next()}}),i}),define("mobileui/utils/transform-animation",["mobileui/utils/basic-animation","mobileui/utils/transform"],function(e,t){var n=function(n){e.call(this,n),this._transform=new t,this._startTransform=null};return _.extend(n.prototype,e.prototype,{getTransform:function(){return this._transform},startTransform:function(){return this._startTransform||(this._startTransform=new t),this._startTransform},_internalStart:function(e,t,n){n.startTransform=t.transform().clone()},_internalCompute:function(e,t,n){n.started&&e.requestFrame();var r;this._startTransform?r=this._startTransform.blend(n.timingFunctionPercent,this._transform):r=n.startTransform.blend(n.timingFunctionPercent,this._transform),t.transform().take(r)}}),n}),define("mobileui/utils/opacity-animation",["mobileui/utils/basic-animation"],function(e){var t=function(t){e.call(this,t),this._arguments=0,this._startOpacity=null};return _.extend(t.prototype,e.prototype,{opacity:function(){return this._opacity},setOpacity:function(e){return this._opacity=e,this},startOpacity:function(){return this._startOpacity},setStartOpacity:function(e){return this._startOpacity=e,this},_internalStart:function(e,t,n){n.startOpacity=t.opacity()},_internalCompute:function(e,t,n){n.started&&e.requestFrame();var r;this._startOpacity!==null?r=this._startOpacity*(1-n.timingFunctionPercent)+n.timingFunctionPercent*this._opacity:r=n.startOpacity*(1-n.timingFunctionPercent)+n.timingFunctionPercent*this._opacity,t.setOpacity(r)}}),t}),define("mobileui/utils/filter-animation",["mobileui/utils/basic-animation","mobileui/utils/filter"],function(e,t){var n=function(n){e.call(this,n),this._filter=new t,this._startFilter=null};return _.extend(n.prototype,e.prototype,{getFilter:function(){return this._filter},startFilter:function(){return this._startFilter||(this._startFilter=new Transform),this._startFilter},_internalStart:function(e,t,n){n.startFilter=t.filter().clone()},_internalCompute:function(e,t,n){n.started&&e.requestFrame();var r;this._startFilter?r=this._startFilter.blend(n.timingFunctionPercent,this._filter):r=n.startFilter.blend(n.timingFunctionPercent,this._filter),t.filter().take(r)}}),n}),define("mobileui/utils/animation-set",["mobileui/utils/animation-controller","mobileui/utils/animation","mobileui/utils/transform-animation","mobileui/utils/opacity-animation","mobileui/utils/filter-animation"],function(e,t){var n=function(e){t.call(this,"animationSet"),this._view=e};return _.extend(n.prototype,t.prototype,{start:function(){return e.instance.register(this)&&this.trigger("start"),this},inlineStart:function(){return this.start(),e.instance.runOnRequestAnimationFrame(),this},stop:function(){return e.instance.unregister(this)&&this.trigger("stop"),this},compute:function(e){e.prepareSet(),t.prototype.compute.call(this,e,this._view),e.isSetActive()||this.stop()}}),n}),define("mobileui/views/layout-params",[],function(){var e=function(){this._width=null,this._height=null,this._weight=1};return _.extend(e.prototype,{width:function(){return this._width},setWidth:function(e){return this._width=e,this},fillParentWidth:function(){return this.setWidth(e.FILL_PARENT)},matchParentWidth:function(){return this.setWidth(e.MATCH_PARENT)},matchChildrenWidth:function(){return this.setWidth(e.MATCH_CHILDREN)},height:function(){return this._height},setHeight:function(e){return this._height=e,this},fillParentHeight:function(){return this.setHeight(e.FILL_PARENT)},matchParentHeight:function(){return this.setHeight(e.MATCH_PARENT)},matchChildrenHeight:function(){return this.setHeight(e.MATCH_CHILDREN)},matchParent:function(){return this.setWidth(e.MATCH_PARENT).setHeight(e.MATCH_PARENT)},fillParent:function(){return this.setWidth(e.FILL_PARENT).setHeight(e.FILL_PARENT)},matchChildren:function(){return this.setWidth(e.MATCH_CHILDREN).setHeight(e.MATCH_CHILDREN)},weight:function(){return this._weight},setWeight:function(e){return this._weight=e,this}}),_.extend(e,{FILL_PARENT:"fill-parent",MATCH_PARENT:"match-parent",MATCH_CHILDREN:"match-children"}),e}),define("mobileui/views/touch",["mobileui/utils/request-animation-frame","mobileui/utils/boilerplate"],function(e,t){function n(e){this.identifier=e,this.startPosition=null,this.currentPosition=null,this.state=null,this.view=null,this.type=n.TOUCH,this.dragSurface=null,this.previewBox=null,this.animationFrameRequested=!1}return n.preview=!0,n.togglePreview=function(){n.preview=!n.preview},n.previewBoxesPool=[],n.popPreviewBox=function(){var e=n.previewBoxesPool.pop();return e||(e=$("<div />").addClass("touch-preview").appendTo(document.body)),e},n.pushPreviewBox=function(e){n.previewBoxesPool.push(e)},_.extend(n.prototype,{attachToSurface:function(e){this.dragSurface=e,n.injectLocalPoints(e,this.startPosition),n.injectLocalPoints(e,this.currentPosition)},update:function(e){this.currentPosition=e;var t=this.dragSurface||this.view;t&&n.injectLocalPoints(t,this.currentPosition),this.updatePreviewBox()},createPreviewBox:function(){if(this.previewBox)return;this.previewBox=n.popPreviewBox(),this.previewBox.css("opacity",1)},updatePreviewBox:function(){if(!n.preview)return;if(this.animationFrameRequested)return;var r=this;e(function(){r.animationFrameRequested=!1;if(r.state==n.END||r.state==n.CANCELED)return r.removePreviewBox();r.createPreviewBox(),r.previewBox.css(t.prefixOne("transform"),"translate3d("+r.currentPosition.pageX+"px, "+r.currentPosition.pageY+"px, 0px)")})},removePreviewBox:function(){if(!this.previewBox)return;this.previewBox.css("opacity",0),n.pushPreviewBox(this.previewBox),this.previewBox=null}}),n.Point=t.lookupUpperCasePrefix(window,"Point"),n.convertPointFromPageToNode=t.lookupPrefix(window,"convertPointFromPageToNode"),n.getPosition=function(e){var t={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.pageX,localY:e.pageY,parentX:e.pageX,parentY:e.pageY,time:Date.now()};return t},n.injectLocalPoints=function(e,t){if(n.Point){var r=new n.Point;r.x=t.pageX,r.y=t.pageY;var i=n.convertPointFromPageToNode.call(window,e.$el.get(0),r),s=n.convertPointFromPageToNode.call(window,e.$el.get(0).parentNode,r);t.localX=i?i.x:t.pageX,t.localY=i?i.y:t.pageY,t.parentX=s?s.x:t.localX,t.parentY=s?s.y:t.localY}return t},n.START="start",n.MOVE="move",n.END="end",n.CANCELED="canceled",n.TOUCH="touch",n.MOUSE="mouse",n}),define("mobileui/views/touch-manager",["mobileui/views/touch","mobileui/utils/request-animation-frame"],function(e,t){function n(){this.touchEvents={onTouchStart:this.onTouchStart.bind(this),onTouchMove:this.onTouchMove.bind(this),onTouchEnd:this.onTouchEnd.bind(this),onTouchCancel:this.onTouchCancel.bind(this),onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this)},this.mouseEvent=null,this.touchPointsSet={},this.touchPoints=[],this.touchEventsInstalled=!1,this.mouseEventsInstalled=!1,this.captureTouchSurface=null}return _.extend(n.prototype,Backbone.Events,{inlineUpdate:function(){t.runInlinesIfNeeded()},findTouch:function(e){return this.touchPointsSet[e]},setTouch:function(e){this.touchPointsSet[e.identifier]=e,this.touchPoints.push(e)},cancelTouch:function(t){var n=this.findTouch(t);if(!n)return;n.view&&(n.view.removeTouch(n),n.view.trigger("touchcanceled",n)),this.removeTouch(n),n.state=e.CANCELED,n.updatePreviewBox()},removeTouch:function(e){this.touchPointsSet[e.identifier]=null;var t=this.touchPoints.indexOf(e);t!=-1&&this.touchPoints.splice(t,1),this.touchPoints.length||this.removeTouchTrackingEvents()},installTouchTrackingEvents:function(){if(this.touchEventsInstalled)return;this.touchEventsInstalled=!0,window.addEventListener("touchstart",this.touchEvents.onTouchStart,!0),window.addEventListener("touchmove",this.touchEvents.onTouchMove,!0),window.addEventListener("touchend",this.touchEvents.onTouchEnd,!0),window.addEventListener("touchcancel",this.touchEvents.onTouchCancel,!0)},removeTouchTrackingEvents:function(){if(!this.touchEventsInstalled)return;this.touchEventsInstalled=!1,window.removeEventListener("touchstart",this.touchEvents.onTouchStart,!0),window.removeEventListener("touchmove",this.touchEvents.onTouchMove,!0),window.removeEventListener("touchend",this.touchEvents.onTouchEnd,!0),window.removeEventListener("touchcancel",this.touchEvents.onTouchCancel,!0)},installMouseTrackingEvents:function(){if(this.mouseEventsInstalled)return;this.mouseEventsInstalled=!0,window.addEventListener("mousedown",this.touchEvents.onMouseDown,!0),window.addEventListener("mousemove",this.touchEvents.onMouseMove,!0),window.addEventListener("mouseup",this.touchEvents.onMouseUp,!0)},removeMouseTrackingEvents:function(){if(!this.mouseEventsInstalled)return;this.mouseEventsInstalled=!1,window.removeEventListener("mousedown",this.touchEvents.onMouseDown,!0),window.removeEventListener("mousemove",this.touchEvents.onMouseMove,!0),window.removeEventListener("mouseup",this.touchEvents.onMouseUp,!0)},needsNativeTouch:function(e){var t=$(e.target);return!this.captureTouchSurface&&(t.attr("data-native-touch")!==undefined||t.prop("nodeName")==="A")},removeFocus:function(){document.activeElement&&$(document.activeElement).blur()},onTouchStart:function(t){if(this.needsNativeTouch(t))return;this.removeFocus();var n=t.changedTouches;for(var r=0;r<n.length;++r){var i=n[r];if(this.findTouch(n[r].identifier)){t.preventDefault(),t.stopImmediatePropagation();continue}var s=new e(n[r].identifier);s.view=null,s.state=e.START,s.startPosition=s.currentPosition=e.getPosition(i),s.updatePreviewBox(),this.setTouch(s)}this.captureTouchSurface&&this.captureTouchSurface.onTouchStartInternal(t),this.inlineUpdate()},handleTouchStart:function(t){var n=this.findTouch(t.identifier);return n?n:(n=new e(t.identifier),n.view=null,n.state=e.START,n.startPosition=n.currentPosition=e.getPosition(t),n.updatePreviewBox(),this.setTouch(n),this.installTouchTrackingEvents(),n)},onTouchMove:function(t){var n=t.changedTouches;for(var r=0;r<n.length;++r){var i=n[r],s=this.findTouch(i.identifier);if(!s){console.log("Unregister touch identifier detected for touchmove event",i);continue}t.preventDefault(),t.stopImmediatePropagation(),s.state=e.MOVE,s.update(e.getPosition(i)),s.view&&s.view.trigger("touchmove",s)}this.inlineUpdate()},onTouchEnd:function(t){var n=t.changedTouches;for(var r=0;r<n.length;++r){var i=n[r],s=this.findTouch(i.identifier);if(!s){console.log("Unregister touch identifier detected for touchend event",i);continue}t.preventDefault(),t.stopImmediatePropagation(),s.state=e.END,s.update(e.getPosition(i)),this.removeTouch(s),s.view&&(s.view.removeTouch(s),s.view.trigger("touchend",s))}this.inlineUpdate()},onTouchCancel:function(t){var n=t.changedTouches;for(var r=0;r<n.length;++r){var i=n[r],s=this.findTouch(i.identifier);if(!s){console.log("Unregister touch identifier detected for touchcanceled event",i);continue}t.preventDefault(),t.stopImmediatePropagation(),s.state=e.CANCELED,s.update(e.getPosition(i)),this.removeTouch(s),s.view&&(s.view.removeTouch(s),s.view.trigger("touchcanceled",s))}this.inlineUpdate()},onMouseDown:function(t){if(this.needsNativeTouch(t))return;this.removeFocus(),this.cancelTouch(e.MOUSE);var n=new e(e.MOUSE);n.type=e.MOUSE,n.view=null,this.mouseEvent=n,this.setTouch(n),n.startPosition=n.currentPosition=e.getPosition(t),n.state=e.START,n.updatePreviewBox(),this.captureTouchSurface&&this.captureTouchSurface.onMouseDown(t),this.inlineUpdate()},handleMouseDown:function(t){this.cancelTouch(e.MOUSE);var n=new e(e.MOUSE);return n.type=e.MOUSE,n.view=null,this.mouseEvent=n,this.setTouch(n),n.startPosition=n.currentPosition=e.getPosition(t),n.state=e.START,n.updatePreviewBox(),this.installMouseTrackingEvents(),n},onMouseMove:function(t){var n=this.findTouch(e.MOUSE);if(!n)return;t.preventDefault(),t.stopImmediatePropagation(),n.state=e.MOVE,n.update(e.getPosition(t)),n.view&&n.view.trigger("touchmove",n),this.inlineUpdate()},onMouseUp:function(t){this.mouseEvent=null;var n=this.findTouch(e.MOUSE);if(!n)return;t.preventDefault(),t.stopImmediatePropagation(),n.state=e.END,n.update(e.getPosition(t)),this.removeTouch(n),n.view&&(n.view.removeTouch(n),n.view.trigger("touchend",n)),this.removeMouseTrackingEvents(),this.inlineUpdate()}}),n.instance=new n,n}),define("mobileui/views/touch-view-mixin",["mobileui/views/touch","mobileui/views/touch-manager"],function(e,t){var n={initializeTouchViewMixin:function(){return this.touchEvents={installed:!1,onTouchStart:this.onTouchStart.bind(this),onMouseDown:this.onMouseDown.bind(this),onClick:this.onClick.bind(this)},this.touchPointsSet={},this.touchPoints=[],this},installTouchEvents:function(){if(this.touchEvents.installed)return;var e=this.$el.get(0);e.addEventListener("touchstart",this.touchEvents.onTouchStart,!1),e.addEventListener("mousedown",this.touchEvents.onMouseDown,!1),e.addEventListener("click",this.touchEvents.onClick,!1)},removeTouchEvents:function(){if(!this.touchEvents.installed)return;var e=this.$el.get(0);e.removeEventListener("touchstart",this.touchEvents.onTouchStart,!1),e.removeEventListener("mousedown",this.touchEvents.onMouseDown,!1),e.removeEventListener("click",this.touchEvents.onClick,!1)},removeTouch:function(e){this.touchPointsSet[e.identifier]=null;var t=this.touchPoints.indexOf(e);t!=-1&&this.touchPoints.splice(t,1)},setTouch:function(e){this.touchPointsSet[e.identifier]=e,this.touchPoints.push(e)},onTouchStartInternal:function(e){e.preventDefault(),e.stopImmediatePropagation();var n=e.changedTouches;for(var r=0;r<n.length;++r){var i=n[r],s=t.instance.findTouch(i.identifier);s||(s=t.instance.handleTouchStart(n[r])),s.view=this,this.setTouch(s),this.trigger("touchstart",s)}},onTouchStart:function(e){if(t.instance.needsNativeTouch(e))return;this.onTouchStartInternal(e),this.inlineUpdate()},onMouseDown:function(n){if(t.instance.needsNativeTouch(n))return;n.preventDefault(),n.stopImmediatePropagation();var r=t.instance.findTouch(e.MOUSE);r||(r=t.instance.handleMouseDown(n)),r.view=this,this.setTouch(r),this.trigger("touchstart",r),this.inlineUpdate()},onClick:function(e){if(t.instance.needsNativeTouch(e))return;e.preventDefault(),e.stopImmediatePropagation(),this.inlineUpdate()}};return n}),define("mobileui/views/gesture-detector",["mobileui/views/touch-manager"],function(e){function t(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}function n(e,n,r,i){var s=(e*r+n*i)/(t(0,0,e,n)*t(0,0,r,i));return Math.acos(s)*180/Math.PI}function r(e,t,r,i){var s=n(1,0,e,t),o=n(1,0,r,i);return t>0&&(s=-s),i>0&&(o=-o),s-o}function i(e,t,n,r,i){this.type=e,this.scrollX=t,this.scrollY=n,this.distanceX=r,this.distanceY=i}function s(e){this.touchesStarted=0,this.didStartDragging=!1,this.didStartTransform=!1,this.canTap=!0,this.longTapDuration=500,this.minDragLength=10,this.longTapTimer=null,this.longTapTimerCallback=this.onLongTapTimer.bind(this),this.longTapTouch=null,this.touchParent=null,this.dragSurface=null,this.draggingTouch=null,this.view=null,e&&this.install(e)}return i.DRAG="drag",i.TRANSFORM="transform",_.extend(s.prototype,Backbone.Events,{install:function(e){this.view=e.setNeedsTouchEvents(!0),e.on("touchstart",this.onGestureTouchStart.bind(this)),e.on("touchmove",this.onGestureTouchMove.bind(this)),e.on("touchend",this.onGestureTouchEnd.bind(this)),e.on("touchcanceled",this.onGestureTouchCanceled.bind(this))},installGestureTimers:function(e){this.clearGestureTimers(),this.longTapTouch=e,this.longTapTimer=setTimeout(this.longTapTimerCallback,this.longTapDuration)},clearGestureTimers:function(){if(!this.longTapTimer)return;this.longTapTouch=null,clearTimeout(this.longTapTimer),this.longTapTimer=null},installTransformCapture:function(){var t=this.findParentTouchSurface(new i(i.TRANSFORM));t&&!t.noTouchCapture&&(e.instance.captureTouchSurface=this.view)},clearTransformCapture:function(){e.instance.captureTouchSurface===this.view&&(e.instance.captureTouchSurface=null)},computeGestureTransform:function(){var e=this.view.touchPoints[0],n=this.view.touchPoints[1],i=(e.startPosition.localX+n.startPosition.localX)/2,s=(e.startPosition.localY+n.startPosition.localY)/2,o=(e.startPosition.parentX+n.startPosition.parentX)/2,u=(e.startPosition.parentY+n.startPosition.parentY)/2,a=t(e.startPosition.parentX,e.startPosition.parentY,n.startPosition.parentX,n.startPosition.parentY),f=(e.currentPosition.parentX+n.currentPosition.parentX)/2,l=(e.currentPosition.parentY+n.currentPosition.parentY)/2,c=t(e.currentPosition.parentX,e.currentPosition.parentY,n.currentPosition.parentX,n.currentPosition.parentY),h=r(n.startPosition.parentX-e.startPosition.parentX,n.startPosition.parentY-e.startPosition.parentY,n.currentPosition.parentX-e.currentPosition.parentX,n.currentPosition.parentY-e.currentPosition.parentY);return{scale:a>0?c/a:0,dragX:f-o,dragY:l-u,originX:i,originY:s,rotation:h}},computeDragTransform:function(e){return{dragX:e.currentPosition.parentX-e.startPosition.parentX,dragY:e.currentPosition.parentY-e.startPosition.parentY}},onGestureTouchStart:function(e){this.touchesStarted=this.view.touchPoints.length==1?1:this.touchesStarted+1;if(this.touchesStarted==1)this.installGestureTimers(e),this.installTransformCapture(),this.view.trigger("tapstart",e);else if(!this.didStartTransform){if(this.didStartDragging){var t=this.view.touchPoints[0];this.dragSurface.trigger("touchdragend",this.computeDragTransform(t),t,!1),this.dragSurface=null,this.didStartDragging=!1,t.startPosition=t.currentPosition}else this.canTap=!1,this.view.trigger("tapend",e);this.clearGestureTimers(),this.dragSurface=this.findParentTouchSurface(new i(i.TRANSFORM)),this.dragSurface&&(this.didStartTransform=!0,this.view.touchPoints[0].attachToSurface(this.dragSurface),this.view.touchPoints[1].attachToSurface(this.dragSurface),this.dragSurface.trigger("touchtransformstart",e),this.clearTransformCapture())}},cancelTransform:function(){if(!this.didStartTransform)return;this.didStartTransform=!1,this.dragSurface=null},onGestureTouchMove:function(e){if(this.didStartTransform){this.dragSurface.trigger("touchtransform",this.computeGestureTransform());return}if(!this.didStartDragging&&this.touchesStarted==1){var t=e.startPosition.pageX-e.currentPosition.pageX,n=Math.abs(t),r=e.startPosition.pageY-e.currentPosition.pageY,s=Math.abs(r);n>s?s=0:n=0;var o=n>this.minDragLength,u=s>this.minDragLength;if(o||u)this.canTap=!1,this.view.trigger("tapend",e),this.clearGestureTimers(),this.dragSurface=this.findParentTouchSurface(new i(i.DRAG,o,u,t,r)),this.dragSurface&&(e.attachToSurface(this.dragSurface),e.dragStartTime=e.currentPosition.time-e.startPosition.time,this.didStartDragging=!0,this.dragSurface.draggingTouch=e,this.dragSurface.trigger("touchdragstart",e))}this.didStartDragging&&e===this.dragSurface.draggingTouch&&this.dragSurface.trigger("touchdragmove",this.computeDragTransform(e),e)},startDraggingFromLongTap:function(){var e=this.view.touchPoints[0];if(!e)return;this.canTap=!1,this.view.trigger("tapend",e),this.clearGestureTimers(),this.dragSurface=this,this.didStartDragging=!0,e.attachToSurface(this.dragSurface),e.dragStartTime=e.currentPosition.time-e.startPosition.time,this.dragSurface.draggingTouch=e,this.dragSurface.trigger("touchdragstart",e)},onLongTapTimer:function(){this.clearGestureTimers(),this.view.trigger("longtaptimer",this.longTapTouch),this.view.$el.parent().length||this.clearTransformCapture()},onGestureTouchEnd:function(e){this.clearGestureTimers();if(this.didStartTransform)this.view.touchPoints.length==1&&(this.dragSurface.trigger("touchtransformend",e),this.didStartTransform=!1,this.didStartDragging=!1,this.dragSurface=null,this.installTransformCapture());else if(this.canTap){this.view.trigger("tapend",e);var t=e.currentPosition.time-e.startPosition.time;this.view.trigger(t<this.longTapDuration?"tap":"longtap",e)}this.view.touchPoints.length||(this.didStartDragging?this.dragSurface.trigger("touchdragend",this.computeDragTransform(e),e,!0):this.didStartTransform&&this.dragSurface.trigger("touchtransformend",e),this.finishGesture(e))},finishGesture:function(e){this.dragSurface&&(this.dragSurface.draggingTouch=null,this.dragSurface.trigger("gestureend",e),this.dragSurface=null),this.didStartTransform=!1,this.didStartDragging=!1,this.touchesStarted=0,this.canTap=!0,this.clearTransformCapture()},onGestureTouchCanceled:function(e){this.onGestureTouchEnd(e)},findParentTouchSurface:function(e){for(var t=this.view;t;t=t.parent())if(t.respondsToTouchGesture&&t.respondsToTouchGesture(e))return t;return null}}),s.GestureType=i,s}),define("mobileui/views/layer-view",["mobileui/utils/rect","mobileui/utils/transform","mobileui/utils/filter","mobileui/utils/outsets","mobileui/utils/animation-set","mobileui/utils/request-animation-frame","mobileui/views/layout-params","mobileui/views/touch-view-mixin","mobileui/views/gesture-detector"],function(e,t,n,r,i,s,o,u,a){var f=Backbone.View.extend(u).extend({initialize:function(){f.__super__.initialize.call(this),this.initializeTouchViewMixin(),this._bounds=new e,this._transform=new t,this._filter=new n,this._margin=new r,this._padding=new r,this._opacity=1,this._animation=null,this._params=null,this._bounds.on("change:position",this._onPositionChanged,this),this._bounds.on("change:size",this._onSizeChanged,this),this._transform.on("change",this._onTransformChanged,this),this._filter.on("change",this._onFilterChanged,this),this._padding.on("change",this._onPaddingChanged,this),this._margin.on("change",this._onMarginChanged,this),this._invalidationFlags=null,this._needsLayout=!1,this._state=f.VISIBLE,this._needsTouchEvents=!1,this._visible=!0},inlineUpdate:function(){s.runInlinesIfNeeded()},setNeedsTouchEvents:function(e){return this._needsTouchEvents==e?this:(this.$el&&this.$el.length&&(e?this.installTouchEvents():this.removeTouchEvents()),this._needsTouchEvents=e,this)},addGestureDetector:function(){this._gestureDetector||(this._gestureDetector=new a(this))},animation:function(){return this._animation||(this._animation=new i(this)),this._animation},hasAnimation:function(){return!!this._animation},forceLayer:function(){return this.animation(),this.transform().clear(),this},setElement:function(e){this.$el&&(this.$el.data("layer-view",null),this.removeTouchEvents()),f.__super__.setElement.call(this,e),this.$el&&(this.$el.data("layer-view",this),this._needsTouchEvents&&this.installTouchEvents())},childrenViews:function(){var e=[];return this.$el.children().each(function(t,n){var r=$(n).data("layer-view");r&&e.push(r)}),e},params:function(){return this._params},setParams:function(e){return this._params=e,this.setNeedsLayout(!0),this},matchParentSize:function(){return this.setParams((new o).matchParent()),this},append:function(e){return s.setHadDOMUpdates(),this.$el.append(e.$el),this._childAdded(e,!1)},appendWithAnimation:function(e){return s.setHadDOMUpdates(),this.$el.append(e.$el),this._childAdded(e,!0)},prepend:function(e){return s.setHadDOMUpdates(),this.$el.prepend(e.$el),this._childAdded(e,!1)},before:function(e,t){return s.setHadDOMUpdates(),t.$el.before(e.$el),this._childAdded(e,!1)},beforeWithAnimation:function(e,t){return s.setHadDOMUpdates(),t.$el.before(e.$el),this._childAdded(e,!0)},after:function(e,t){return s.setHadDOMUpdates(),t.$el.after(e.$el),this._childAdded(e,!1)},afterWithAnimation:function(e,t){return s.setHadDOMUpdates(),t.$el.after(e.$el),this._childAdded(e,!0)},detachWithAnimation:function(){return this._internalDetachWithAnimation("detach")},removeWithAnimation:function(){return this._internalDetachWithAnimation("remove")},detach:function(){return this._internalDetach("detach")},remove:function(){return this._internalDetach("remove")},_internalDetachWithAnimation:function(e){if(this._state!=f.REMOVED){var t=this.parent();if(t)return t._childRemoved(this,e,!0);this._internalDetachRemove(e)}return $.Deferred().resolveWith(this).promise()},_internalDetach:function(e){if(this._state==f.REMOVED)return this;var t=this.parent();return t?t._childRemoved(this,e,!1):(this._internalDetachRemove(e),this)},_childAdded:function(e,t){return e.setNeedsLayout(!0),this.setNeedsLayout(!0),e._state=f.VISIBLE,t?(e.everHadLayout=!1,this._animateAttach(e).then(function(){return e})):this},_animateAttach:function(e){return $.Deferred().resolveWith(e).promise()},_internalDetachRemove:function(e){s.setHadDOMUpdates(),e=="detach"?this.$el.detach():this.$el.remove()},_childRemoved:function(e,t,n){return this.setNeedsLayout(!0),e._state=f.REMOVED,n?this._animateDetach(e).then(function(){return e._internalDetachRemove(t),e}):(e._internalDetachRemove(t),e)},_animateDetach:function(e){return $.Deferred().resolveWith(e).promise()},shouldIgnoreDuringLayout:function(){return this._state==f.REMOVED},addClass:function(e){return this.$el.addClass(e),this},removeClass:function(e){return this.$el.removeClass(e),this},hide:function(){return this._visible?(this._visible=!1,this.invalidate("visibility"),this):this},show:function(){return this._visible?this:(this._visible=!0,this.invalidate("visibility"),this)},setVisible:function(e){return this._visible==e?this:(this._visible=e,this.invalidate("visibility"),this)},visible:function(){return this._visible},parent:function(){var e=this.$el.parent();for(;e.length;e=e.parent()){var t=e.data("layer-view");if(t)return t}return null},layoutIfNeeded:function(){if(!this._needsLayout)return;this.layout()},layoutChildren:function(){this.setLayoutOnChildren(),_.each(this.childrenViews(),function(e){e.layoutIfNeeded()})},layoutBounds:function(){var e=this.params();if(!e)return;var t=this.parent();if(!t)return;e.width()==o.MATCH_PARENT&&this.bounds().setWidth(t.bounds().width()),e.height()==o.MATCH_PARENT&&this.bounds().setHeight(t.bounds().height())},setLayoutOnChildren:function(){if(!this.checkInvalidationFlag("size"))return;_.each(this.childrenViews(),function(e){e.setNeedsLayout(!0)})},layout:function(){this.layoutBounds(),this.layoutChildren(),this.setNeedsLayout(!1)},setNeedsLayout:function(e){if(this._needsLayout==e)return;this._needsLayout=e;if(e&&this.$el.parent().length){var t=this.parent();t?t.setNeedsLayout(e):s.once("layout",this.onBeforeUpdate,this).run()}},onBeforeUpdate:function(){this.layoutIfNeeded()},updateLayout:function(){return this.setNeedsLayout(!0),this},setBounds:function(e){this._bounds.set(e)},bounds:function(){return this._bounds},setMargin:function(e){this._margin.set(e)},margin:function(){return this._margin},setPadding:function(e){this._padding.set(e)},padding:function(){return this._padding},outerWidth:function(){return this.bounds().width()+this.padding().horizontal()+this.margin().horizontal()},outerHeight:function(){return this.bounds().height()+this.padding().vertical()+this.margin().vertical()},setTransform:function(e){this._transform.set(e)},transform:function(){return this._transform},setFilter:function(e){this._filter.set(e)},filter:function(){return this._filter},opacity:function(){return this._opacity},setOpacity:function(e){return this._opacity=e,this._onOpacityChanged(),this},render:function(){return this.$el.addClass("js-layer-view"),this._validatePosition(),this._validateSize(),this._validateTransform(),this},invalidate:function(e){this._requestAnimationFrame(),this._invalidationFlags[e]=!0},checkInvalidationFlag:function(e){return this._invalidationFlags?this._invalidationFlags[e]:!1},_requestAnimationFrame:function(){if(this._invalidationFlags)return;this._invalidationFlags={},s(this._update.bind(this))},_update:function(){if(!this._invalidationFlags)return;var e=this._invalidationFlags;this._invalidationFlags=null;var t=this;_.each(e,function(e,n){if(!e)return;t._validate(n)}),this.trigger("update")},_validate:function(e){var t=this["_validate"+_.string.capitalize(e)];t?t.call(this):this.trigger("validate:"+e)},_validatePosition:function(){this.$el.css("left",this._bounds.x()).css("top",this._bounds.y())},_validateSize:function(){this.$el.css("width",this._bounds.width()).css("height",this._bounds.height())},_validateTransform:function(){var e=this._transform;this._animation&&!e.has3DTransforms()?this.$el.css("transform",e.toString()+" translateZ(0)"):this.$el.css("transform",e.toString())},_validateFilter:function(){this.$el.css(n.propertyName,this._filter.toString())},_validateOpacity:function(){var e=this._opacity;this.$el.css("opacity",e)},_validateVisibility:function(){this.$el.toggleClass("js-layer-view-invisible",!this._visible)},_validatePadding:function(){this.$el.css("padding",this._padding.toCSSString("px"))},_validateMargin:function(){this.$el.css("margin",this._margin.toCSSString("px"))},_onPositionChanged:function(){this.invalidate("position")},_onSizeChanged:function(){this.invalidate("size")},_onTransformChanged:function(){this.invalidate("transform")},_onFilterChanged:function(){this.invalidate("filter")},_onOpacityChanged:function(){this.invalidate("opacity")},_onPaddingChanged:function(){this.invalidate("padding"),this.setNeedsLayout(!0)},_onMarginChanged:function(){this.invalidate("margin")}});return _.extend(f,{VISIBLE:"visible",REMOVED:"removed"}),f}),define("mobileui/ui/navigator-card-view",["mobileui/views/layer-view","mobileui/views/layout-params"],function(e,t){var n=e.extend({initialize:function(){n.__super__.initialize.call(this),this.matchParentSize(),this._navigatorView=null,this.on("activate",this.updateRouterLocation,this)},render:function(){return this.$el.addClass("js-navigator-card-view"),n.__super__.render.call(this)},_setNavigatorView:function(e){return this._navigatorView=e,this.trigger("change:navigatorView"),this.trigger(this._navigatorView?"attached":"detached"),this},updateRouterLocation:function(){},navigatorView:function(){return this._navigatorView},topBarView:function(){return this._navigatorView?this._navigatorView.topBarView():null}});return n}),define("mobileui/utils/momentum",["mobileui/utils/time"],function(e){function t(e){return e>=0?1:-1}var n=function(e){this._duration=e,this._friction=.005,this.reset(0)};return _.extend(n.prototype,Backbone.Events,{setDuration:function(e){return this._duration=e,this},setFriction:function(e){return this._friction=e,this},reset:function(e){this._currentValue=e,this._direction=0,this._internalResetGesture()},computeDelta:function(){var n=e.now(),r=n-this._startTime;if(!r)return 0;var i=(this._currentValue-this._startValue)/r;return Math.max(0,i*i*this._duration-this._friction*this._duration*this._duration)*t(i)},compute:function(){var e=this.computeDelta();return this._currentValue+e},_internalResetGesture:function(){this._startValue=this._currentValue,this._startTime=e.now()},injectValue:function(e){if(this._currentValue==e)return;var n=t(this._currentValue-e);this._direction!=n&&(this._direction&&this._internalResetGesture(),this._direction=n),this._currentValue=e},direction:function(){return this._direction}}),n}),define("views/app-card-view",["mobileui/ui/navigator-card-view","mobileui/utils/transform","mobileui/utils/filter","mobileui/utils/momentum","mobileui/views/gesture-detector","app"],function(e,t,n,r,i,s){var o=e.extend({initialize:function(){o.__super__.initialize.call(this),this.addGestureDetector(),this.on("touchdragstart",this._onDragStart,this).on("touchdragmove",this._onDragMove,this).on("touchdragend",this._onDragEnd,this),this._momentum=(new r).setDuration(300).setFriction(5e-6),this._dragStartValue=0,this.on("card:precommit",this._updateBackButton,this),this.on("activate",this._updateBackButton,this),this.forceLayer()},_updateBackButton:function(){s.mainView.navigatorView().updateBackButton()},render:function(){return this.$el.addClass("js-app-card-view"),o.__super__.render.call(this)},respondsToTouchGesture:function(e){return e.type!=i.GestureType.DRAG?!1:e.scrollX&&e.distanceX<0&&s.mainView.navigatorView().activeCard()===this&&s.mainView.navigatorView().canGoBack()},_onDragStart:function(){var e=s.mainView.navigatorView().prepareHistoryCard().nextCard();e.filter().get("grayscale").setIntensity(100);var t=this.transform().get("translate");this._dragStartValue=t.x(),this._momentum.reset(this._dragStartValue)},_onDragMove:function(e){var t=this.transform().get("translate"),n=Math.max(0,this._dragStartValue+e.dragX);t.setX(n);var r=s.mainView.navigatorView().nextCard();r.filter().get("grayscale").setIntensity(100-n/this.bounds().width()*100),this._momentum.injectValue(n)},_onDragEnd:function(e){this._onDragMove(e);var t=this._momentum.compute()*4,n=this._momentum.direction();if(t<this.bounds().width()||n>0)return this._revert();this._commit()},_commit:function(){var e=this,r=s.mainView.navigatorView().nextCard();s.mainView.navigatorView().precommitNextCard();var i=(new t).translate(this.bounds().width(),0);this.animation().start().get("slide-transform").chain().transform(300,i).wait(100).callback(function(){r.filter().clear(),s.mainView.navigatorView().commitNextCard()}),this.animation().get("slide").chain().opacity(300,100),r.animation().start().get("slide-filter").chain().filter(300,(new n).grayscale(0))},_revert:function(){var e=this,r=s.mainView.navigatorView().nextCard(),i=new t;this.animation().start().get("slide-transform").chain().transform(100,i).callback(function(){r.filter().clear(),s.mainView.navigatorView().revertNextCard()}),this.animation().get("slide").chain().opacity(100,1),r.animation().start().get("slide-filter").chain().filter(300,(new n).grayscale(100))},url:function(){return null},updateRouterLocation:function(){var e=this.url();if(!e)return;s.router.navigate(e,{trigger:!1})}});return o}),define("mobileui/views/gesture-view",["mobileui/views/layer-view","mobileui/views/gesture-detector"],function(e,t){var n=e.extend({initialize:function(){n.__super__.initialize.call(this),this.addGestureDetector()},render:function(){return this.$el.addClass("js-gesture-view"),n.__super__.render.call(this)}});return n}),define("mobileui/views/scroll-view",["mobileui/views/gesture-view","mobileui/views/layer-view","mobileui/views/gesture-detector","mobileui/utils/boilerplate","mobileui/utils/momentum","mobileui/utils/transform"],function(e,t,n,r,i,s){var o=10,u=e.extend({initialize:function(){u.__super__.initialize.call(this),this.on("touchdragstart",this._onTouchDragStart,this),this.on("touchdragmove",this._onTouchDragMove,this),this.on("touchdragend",this._onTouchDragEnd,this),this._contentView=null,this._scrollLeft=0,this._scrollTop=0,this._touchStartState=null,this._canOverScroll=!1,this._scrollDirection=u.BOTH,this._scrollAnimationDuration=300,this._momentumLeft=new i(this._scrollAnimationDuration),this._momentumTop=new i(this._scrollAnimationDuration),this._maxMomentum=100,this._useAnimation=!1,this._horizontalView=new t,this._horizontalView.forceLayer().addClass("js-scroll-view-indicator").addClass("js-scroll-view-horizontal-indicator"),this._horizontalView.bounds().setSize(1,4),this._horizontalView.transform().translate().scale(0,1),this.append(this._horizontalView.render()),this._verticalView=new t,this._verticalView.forceLayer().addClass("js-scroll-view-indicator").addClass("js-scroll-view-vertical-indicator"),this._verticalView.bounds().setSize(4,1),this._verticalView.transform().translate().scale(1,0),this.append(this._verticalView.render())},render:function(){return this.$el.addClass("js-scroll-view").on("mousewheel",this._onMouseWheel.bind(this)),u.__super__.render.call(this)},setScrollAnimationDuration:function(e){return this._scrollAnimationDuration=e,this._momentumLeft.setDuration(e),this._momentumTop.setDuration(e),this},setScrollDirection:function(e){return this._scrollDirection=e,this.invalidate("scroll"),this},_verticalScrollHeight:function(){return Math.max(o,this.bounds().height()/this.scrollHeight()*this.bounds().height())},_horizontalScrollWidth:function(){return Math.max(o,this.bounds().width()/this.scrollWidth()*this.bounds().width())},layout:function(){u.__super__.layout.call(this),this._verticalView.setVisible(this.hasVerticalScroll()).bounds().setX(this.bounds().width()-this._verticalView.bounds().width()),this._horizontalView.setVisible(this.hasHorizontalScroll()).bounds().setY(this.bounds().height()-this._horizontalView.bounds().height()),this._verticalView.transform().get("scale").setY(this._verticalScrollHeight()),this._horizontalView.transform().get("scale").setX(this._horizontalScrollWidth()),this.invalidate("scroll")},setContentView:function(e){if(this._contentView===e)return;return this._contentView&&(this._contentView.remove(),this._contentView=null),e&&(this._contentView=e,this.prepend(e)),this},contentView:function(){return this._contentView},scrollTo:function(e,t){if(!this._contentView)return;if(this._scrollLeft==e&&this._scrollTop==t)return;this._scrollLeft=e,this._scrollTop=t,this.invalidate("scroll")},scrollBy:function(e,t){if(!this._contentView||!e&&!t)return;this._scrollLeft+=e,this._scrollTop+=t,this.invalidate("scroll")},scrollWidth:function(){return this._contentView?this._contentView.bounds().width():0},scrollHeight:function(){return this._contentView?this._contentView.bounds().height():0},maxScrollLeft:function(){return Math.max(0,this._contentView.outerWidth()-this.bounds().width())},maxScrollTop:function(){return Math.max(0,this._contentView.outerHeight()-this.bounds().height())},hasHorizontalScroll:function(){return this.scrollWidth()>this.bounds().width()},hasVerticalScroll:function(){return this.scrollHeight()>this.bounds().height()},_checkScrollPosition:function(){if(!this._canOverScroll||this._scrollDirection==u.VERTICAL)this._scrollLeft=Math.max(0,Math.min(this._scrollLeft,this.maxScrollLeft()));if(!this._canOverScroll||this._scrollDirection==u.HORIZONTAL)this._scrollTop=Math.max(0,Math.min(this._scrollTop,this.maxScrollTop()))},_validateScroll:function(){if(!this._contentView)return;if(this._useAnimation){this._useAnimation=!1,this._validateScrollWithAnimation();return}this._checkScrollPosition();if(this._contentView.getLayout){var e=this._contentView.getLayout();if(e&&e.scroll){var t={left:this._scrollLeft,top:this._scrollTop};e.scroll(this,t);return}}this._internalScroll()},_computeVerticalBarPosition:function(e){return e/this.scrollHeight()*(this.bounds().height()-this._verticalView.bounds().height())},_computeHorizontalBarPosition:function(e){return e/this.scrollWidth()*(this.bounds().width()-this._horizontalView.bounds().width())},_internalScroll:function(){var e=this.contentView();e.transform().get("translate").setX(-this._scrollLeft).setY(-this._scrollTop),this._verticalView.transform().get("translate").setY(this._computeVerticalBarPosition(this._scrollTop)),this._horizontalView.transform().get("translate").setX(this._computeHorizontalBarPosition(this._scrollLeft))},_adjustMomentum:function(e,t,n){return e>0&&t<=0||e<n&&t>=n?t:Math.max(t-this._maxMomentum,Math.min(e,t+this._maxMomentum))},_validateScrollWithAnimation:function(){var e=this._scrollLeft,t=this._scrollTop;this._scrollDirection==u.VERTICAL&&(e=Math.max(0,Math.min(e,this.maxScrollLeft()))),this._scrollDirection==u.HORIZONTAL&&(t=Math.max(0,Math.min(t,this.maxScrollTop()))),this._checkScrollPosition(),e=this._adjustMomentum(e,this._scrollLeft,this.maxScrollLeft()),t=this._adjustMomentum(t,this._scrollTop,this.maxScrollTop());if(this._contentView.getLayout){var n=this._contentView.getLayout();if(n&&n.scrollWithAnimation){var r={left:this._scrollLeft,top:this._scrollTop,momentumLeft:e,momentumTop:t,duration:this._scrollAnimationDuration};n.scrollWithAnimation(this,r)}}this._internalScrollWithAnimation(e,t)},_internalScrollWithAnimation:function(e,t){var n=this.contentView(),r=n.animation().inlineStart().get("scroll").removeAll().chain(),i=this._verticalView.animation().inlineStart().get("scroll").removeAll().chain(),o=this._horizontalView.animation().inlineStart().get("scroll").removeAll().chain(),u,a;if(e!=this._scrollLeft||t!=this._scrollTop)r=r.transform(this._scrollAnimationDuration/2,(new s).translate(-e,-t)).setTimingFunction("easeOut"),u=this._verticalView.transform().clone(),u.get("translate").setY(this._computeVerticalBarPosition(t)),i=i.transform(this._scrollAnimationDuration/2,u).setTimingFunction("easeOut"),a=this._horizontalView.transform().clone(),a.get("translate").setX(this._computeHorizontalBarPosition(e)),o=o.transform(this._scrollAnimationDuration/2,a).setTimingFunction("easeOut");r.transform(this._scrollAnimationDuration,(new s).translate(-this._scrollLeft,-this._scrollTop)).setTimingFunction("easeOut"),u=this._verticalView.transform().clone(),u.get("translate").setY(this._computeVerticalBarPosition(this._scrollTop)),i.transform(this._scrollAnimationDuration,u).setTimingFunction("easeOut"),a=this._horizontalView.transform().clone(),a.get("translate").setX(this._computeHorizontalBarPosition(this._scrollLeft)),o.transform(this._scrollAnimationDuration,a).setTimingFunction("easeOut")},_onMouseWheel:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.originalEvent,n=0,i=t.wheelDelta;t.hasOwnProperty("wheelDeltaX")&&(n=t.wheelDeltaX,i=t.wheelDeltaY),r.lookupPrefix(t,"directionInvertedFromDevice")&&(n*=-1,i*=-1),this.scrollBy(n,i)},respondsToTouchGesture:function(e){return!this._contentView||this._scrollDirection==u.NONE||e.type!=n.GestureType.DRAG?!1:this._scrollDirection!=u.VERTICAL&&e.scrollX||this._scrollDirection!=u.HORIZONTAL&&e.scrollY},_stopScrollAnimation:function(){this._useAnimation=!1;var e=this.contentView();if(e.hasAnimation()){var t=e.transform().get("translate");this._scrolLeft=-t.x(),this._scrollTop=-t.y(),this.contentView().animation().stop().get("scroll").removeAll()}},_onTouchDragStart:function(){this._stopScrollAnimation(),this._touchStartState={scrollLeft:this._scrollLeft,scrollTop:this._scrollTop},this._momentumLeft.reset(this._scrollLeft),this._momentumTop.reset(this._scrollTop),this._canOverScroll=!0},_onTouchDragMove:function(e){if(!this._touchStartState)return;var t=this._touchStartState.scrollLeft-e.dragX,n=this._touchStartState.scrollTop-e.dragY;this._momentumLeft.injectValue(t),this._momentumTop.injectValue(n),this.scrollTo(t,n)},_onTouchDragEnd:function(e){var t=this._touchStartState.scrollLeft-e.dragX,n=this._touchStartState.scrollTop-e.dragY;this._momentumLeft.injectValue(t),this._momentumTop.injectValue(n),this._scrollLeft=this._momentumLeft.compute(),this._scrollTop=this._momentumTop.compute(),this._useAnimation=!0,this._canOverScroll=!1,this._touchStartState=null,this.invalidate("scroll")}},{BOTH:"both",VERTICAL:"vertical",HORIZONTAL:"horizontal",NONE:"none"});return u}),define("mobileui/views/linear-layout",["mobileui/utils/transform","mobileui/views/layout-params"],function(e,t){function n(e,n){return n?e.height()==t.FILL_PARENT:e.width()==t.FILL_PARENT}function r(e,n){return n?e.width()==t.MATCH_CHILDREN:e.height()==t.MATCH_CHILDREN}var i={Vertical:"vertical",Horizontal:"horizontal",direction:null,layout:function(s,o){var u=s.childrenViews(),a=this.direction==i.Vertical,f=s.padding(),l=0,c=s.params(),h=c?r(c,a):!1,p=0,d=[],v=0,m=!1,g=0;_.each(u,function(e){if(!e.visible())return;var t=e.params();if(t&&n(t,a)){v+=t.weight(),m=!0;return}e.layoutIfNeeded(),e.shouldIgnoreDuringLayout()||(l+=a?e.outerHeight():e.outerWidth())});if(m){var y=a?s.bounds().height():s.bounds().width(),b=y-l;g=v>0?b/v:0}l=a?f.top():f.left(),_.each(u,function(t){if(!t.visible())return;var r=t.params(),i=t.bounds(),s=a?f.left():l,u=a?l:f.top();if(r&&n(r,a)){var c=Math.ceil(g*r.weight());a?i.setHeight(c):i.setWidth(c),t.layoutIfNeeded()}if(i.x()!=s||i.y()!=u){if((o.wait||o.duration)&&t.everHadLayout){var v=e().translate(i.x()-s,i.y()-u);t.transform().set(v),t.animation().inlineStart().get("layout").removeAll().chain(o.wait).transform(o.duration,e()),d.push(t.animation().promise())}i.setX(s).setY(u)}t.everHadLayout=!0,t.shouldIgnoreDuringLayout()||(l+=a?t.outerHeight():t.outerWidth()),h&&(p=Math.max(p,a?i.width():i.height()))}),a?(!m&&(!c||c.height()==t.MATCH_CHILDREN)&&s.bounds().setHeight(l-f.top()),h&&s.bounds().setWidth(p)):(!m&&(!c||c.width()==t.MATCH_CHILDREN)&&s.bounds().setWidth(l-f.left()),h&&s.bounds().setHeight(p)),o.promise&&$.when.apply(null,d).then(function(){o.promise.resolveWith(s)})}};return i}),define("mobileui/views/vertical-layout",["mobileui/utils/transform","mobileui/views/linear-layout"],function(e,t){var n=_.extend({},t,{direction:t.Vertical});return n}),define("mobileui/views/horizontal-layout",["mobileui/utils/transform","mobileui/views/linear-layout"],function(e,t){var n=_.extend({},t,{direction:t.Horizontal});return n}),define("mobileui/views/layout-view",["mobileui/views/layer-view","mobileui/views/vertical-layout","mobileui/views/horizontal-layout","mobileui/views/layout-params"],function(e,t,n,r){var i=e.extend({initialize:function(){i.__super__.initialize.call(this),this._layout=null,this._animationWait=null,this._animationDuration=null,this._layoutPromise=null},render:function(){return this.$el.addClass("js-vertical-box-view"),i.__super__.render.call(this)},_internalComputeLayout:function(e){return e=="vertical"?t:e=="horizontal"?n:e},appendFiller:function(){var t=(new e).setParams((new r).fillParentWidth());return this.append(t),this},getLayout:function(){return this._layout},setLayout:function(e){return e=this._internalComputeLayout(e),this._layout===e?this:(this._layout=e,this._animationWait=null,this._animationDuration=null,this._layoutPromise=null,this.setNeedsLayout(!0),this)},setLayoutWithAnimation:function(e){return e=this._internalComputeLayout(e),this._layout===e?$.Deferred().resolveWith(this).promise():(this._layout=e,this._animationWait=null,this._animationDuration=i.AnimationDuration,this.setNeedsLayout(!0),this._layoutPromise=$.Deferred(),this._layoutPromise.promise())},layout:function(){this._layout?(this.layoutBounds(),this.setLayoutOnChildren(),this._layout.layout(this,{wait:this._animationWait,duration:this._animationDuration,promise:this._layoutPromise}),this._animationWait=null,this._animationDuration=null,this._layoutPromise=null,this.setNeedsLayout(!1)):i.__super__.layout.call(this)},_animateAttach:function(e){return this._animationWait=null,this._animationDuration=i.AnimationDuration,e.animation().start().get("opacity").removeAll().chain(i.AnimationDuration).opacity(i.AnimationDuration,0,1),e.setOpacity(0),e.animation().promise()},_animateDetach:function(e,t){return this._animationDuration=i.AnimationDuration,this._animationWait=i.AnimationDuration*2,e.animation().start().get("opacity").removeAll().chain(i.AnimationDuration).opacity(i.AnimationDuration,1,0).wait(this._animationDuration),e.animation().promise().then(function(){e.hasAnimation()&&!e.opacity()&&e.setOpacity(1)})}});return i.AnimationDuration=200,i}),define("mobileui/ui/list-view",["mobileui/views/scroll-view","mobileui/views/layout-view","mobileui/views/layout-params"],function(e,t,n){var r=e.extend({initialize:function(){r.__super__.initialize.call(this),this._itemRendererFactory=null,this._viewItems={},this.setScrollDirection(e.VERTICAL),this.setContentView((new t).setLayout("vertical").setParams((new n).matchParentWidth().matchChildrenHeight())),this._initModel()},_initModel:function(){if(!this.model)return;this.listenTo(this.model,"add",this._onModelAdd),this.listenTo(this.model,"remove",this._onModelRemove),this.listenTo(this.model,"sort",this._onModelSort),this.model.each(this._onModelAdd,this)},setCollection:function(e){return this.model&&(_.each(this._viewItems,function(e){e.remove()}),this._viewItems=null,this.stopListening(this.model),this.model=null),this.model=e,this._initModel(),this},_onModelAdd:function(e){if(!this._itemRendererFactory||this._viewItems[e.cid])return;var t=this._itemRendererFactory(e);if(!t)return;this._viewItems[e.cid]=t;var n=this.previousItemView(e);n?this.contentView().after(t,n):this.contentView().append(t)},previousItemView:function(e){if(!this.model)return null;var t=this.model.indexOf(e);if(t==-1)return null;for(var n=t-1;n>=0;--n){var r=this.model.at(n),i=this._viewItems[r.cid];if(i)return i}return null},indexOfView:function(e){var t=0;for(var n in this._viewItems)if(_.has(this._viewItems,n)){if(e===this._viewItems[n])return t;++t}return-1},itemView:function(e){return this.model?this._viewItems[e.cid]:null},_onModelRemove:function(e){var t=this._viewItems[e.cid];if(!t)return;t.remove()},_onModelSort:function(){},itemRendererFactory:function(){return this._itemRendererFactory},setItemRendererFactory:function(e){return this._itemRendererFactory=e,this},render:function(){return this.$el.addClass("js-list-view"),r.__super__.render.call(this)}});return r}),define("mobileui/views/measured-view",["mobileui/views/layer-view","mobileui/views/layout-params"],function(e,t){var n=e.extend({render:function(){return this.$el.addClass("js-measured-view"),this.$contentView=this.createContentElement().addClass("js-measured-view-content"),this.$el.append(this.$contentView),n.__super__.render.call(this)},setContent:function(e){return this.$contentView.html(e),this.setNeedsLayout(!0),this},setTextContent:function(e){return this.$contentView.text(e),this.setNeedsLayout(!0),this},content:function(){return this.$contentView},createContentElement:function(){return $("<div />")},layout:function(){this.layoutBounds(),this.layoutChildren();var e=this.params();(!e||e.width()!=t.MATCH_PARENT)&&this.bounds().setWidth(this.$contentView.outerWidth()),(!e||e.height()!=t.MATCH_PARENT)&&this.bounds().setHeight(this.$contentView.outerHeight()),this.setNeedsLayout(!1)}});return n}),define("utils/fold",["mobileui/utils/filter"],function(e){return e.registerCustomFilter("fold","t shadow width",function(e){var t=e._width*e._t/5;return"custom(url(style/shaders/fold.vert) mix(url(style/shaders/fold.frag) multiply source-atop), 6 1 detached, t "+e._t.toFixed(6)+", shadow "+e._shadow.toFixed(6)+", transform translate("+(-t).toFixed(6)+"px, 0) perspective(1000) translate("+t.toFixed(6)+"px, 0), mapDepth 150, minSpacing 0.3)"})}),define("views/touch-item-view",["mobileui/views/gesture-detector","mobileui/views/layer-view","mobileui/views/layout-params","mobileui/views/gesture-view","mobileui/utils/transform","mobileui/utils/filter","mobileui/utils/momentum","utils/fold","app"],function(e,t,n,r,i,s,o,u,a){var f=!1,l=300,c=100,h=r.extend({initialize:function(){h.__super__.initialize.call(this),this.once("tap",this._onTap,this).on("touchdragstart",this._onDragStart,this).on("touchdragmove",this._onDragMove,this).on("touchdragend",this._onDragEnd,this),this.setHorizontalLayout(),this.listenTo(this.model,"change:label",this._onLabelChanged),this._filterView=new t,this.append(this._filterView.matchParentSize().forceLayer().render().addClass("js-touch-item-view").addClass(this.model.get("className"))),this.$labelEl=$("<div />").addClass("js-touch-item-view-label").appendTo(this._filterView.$el),this._dragStartValue=0,this._useFilter=!1,this._momentum=(new o).setDuration(l).setFriction(5e-6),this.forceLayer()},filterView:function(){return this._filterView},render:function(){return h.__super__.render.call(this),this.$el.addClass("js-touch-item-parent-view"),this._onLabelChanged(),this},_onLabelChanged:function(){this.$labelEl.text(this.model.get("label"))},useFoldingFilters:function(){return s.supportsCustomFilters&&(this._useFilter=!0),this},_onDragStart:function(){a.mainView.navigatorView().revertNextCard(),this._onTapStart();var e=a.mainView.navigatorView().nextCard();e.filter().get("grayscale").setIntensity(100),e.setOpacity(.5);if(this._useFilter){var t=this._filterView.filter().get("fold");f&&this.filter().get("dropShadow").setRadius(10).setColor(0),this._dragStartValue=-t.t()*this.bounds().width()}else{var n=this.transform().get("translate");this._dragStartValue=this._verticalLayout?n.x():n.y()}this._useFilter&&this.addClass("js-touch-item-view-filter"),this._momentum.reset(this._dragStartValue),this.animation().removeAll()},_minShadow:.7,_maxShadow:1,_computeShadow:function(e){return(1-e)*(this._maxShadow-this._minShadow)+this._minShadow},_onDragMove:function(e){var t=a.mainView.navigatorView().nextCard(),n=t.filter().get("grayscale"),r;if(!this._useFilter){var i=this.transform().get("translate");this._verticalLayout?(r=Math.min(0,this._dragStartValue+e.dragX),i.setX(r),n.setIntensity(100+r/this.bounds().width()*100),t.setOpacity(-r/this.bounds().width()/2+.5)):(r=Math.min(0,this._dragStartValue+e.dragY),i.setY(r),n.setIntensity(100+r/this.bounds().height()*100),t.setOpacity(-r/this.bounds().height()/2+.5))}else{r=Math.min(0,this._dragStartValue+e.dragX);var s=Math.min(.999,Math.max(0,-r/this.bounds().width()));this._filterView.filter().get("fold").setT(s).setShadow(this._computeShadow(s)).setWidth(this.bounds().width()),f&&this.filter().get("dropShadow").setRadius(10).setColor(s),n.setIntensity(100-s*100),t.setOpacity(s/2+.5)}this._momentum.injectValue(r)},animateViewSwitch:function(e){var t=this,n=new i;this._verticalLayout?n.translate(-this.bounds().width(),0):n.translate(0,-this.bounds().height()),this.animation().start().get("slide-transform").chain(50*e).transform(l,n),this.animation().get("slide").chain(50*e).opacity(l,0)},startAnimations:function(e){var t=this,n=this.transform().get("translate");return this._verticalLayout?n.setX(-this.bounds().width()):n.setY(-this.bounds().height()),this.setOpacity(0),this.animation().start().get("slide-transform").chain(50*e).transform(l,(new i).translate(0,0)),this.animation().get("slide").chain(50*e).opacity(l,1),this.animation().promise()},resetAnimations:function(){this.setOpacity(1).transform().clear(),this.filter().clear(),this.animation().removeAll()},_commit:function(){var e=this,t=a.mainView.navigatorView().nextCard(),n=this.animation().start().get("slide-transform").chain();this.off("tap",this._onTap,this),a.mainView.navigatorView().precommitNextCard(),this.trigger("selected",this);if(!this._useFilter){var r=new i;this._verticalLayout?r.translate(-this.bounds().width(),0):r.translate(0,-this.bounds().height()),n=n.transform(l,r)}else{if(f){var o=new s;o.get("dropShadow").setRadius(10).setColor(0),n=n.filter(l,o)}else n=n.wait(l);var u=new s;u.get("fold").setT(1).setShadow(this._computeShadow(1)).setWidth(this.bounds().width()),this._filterView.animation().start().get("slide-filter").chain().filter(l,u)}n.callback(function(){t.filter().clear(),a.mainView.navigatorView().commitNextCard(),e.once("tap",e._onTap,e),e._useFilter&&(e.filter().clear(),e._filterView.filter().clear(),e.removeClass("js-touch-item-view-filter"))}),this.animation().get("slide").chain().opacity(l,0),t.animation().start().get("slide-filter").chain().filter(l,(new s).grayscale(0)),t.animation().get("slide-opacity").chain().opacity(l,1)},_revert:function(){var e=this,t=a.mainView.navigatorView().nextCard(),n=this.animation().start().get("slide-transform").chain();if(!this._useFilter){var r=new i;n=n.transform(c,r)}else{if(f){var o=new s;o.get("dropShadow").setRadius(10).setColor(0),n=n.filter(c,o)}else n=n.wait(c);var u=new s;u.get("fold").setT(0).setShadow(this._computeShadow(0)).setWidth(this.bounds().width()),this._filterView.animation().start().get("slide-filter").chain().filter(c,u)}n.callback(function(){t.filter().clear(),a.mainView.navigatorView().revertNextCard(),e._useFilter&&(e.filter().clear(),e._filterView.filter().clear(),e.removeClass("js-touch-item-view-filter"))}),this.animation().get("slide").chain().opacity(c,1),t.animation().start().get("slide-filter").chain().filter(c,(new s).grayscale(100)),t.animation().get("slide-opacity").chain().opacity(c,.5)},_onDragEnd:function(e){this._onDragMove(e);var t=this._momentum.compute()*4,n=this._momentum.direction();if(this._verticalLayout&&(t>-this.bounds().width()||n<0)||!this._verticalLayout&&(t>-this.bounds().height()||n<0))return this._revert();this._commit()},_onTap:function(){this._onTapStart(),this._useFilter&&(this._filterView.filter().get("fold").setT(0).setShadow(this._computeShadow(0)).setWidth(this.bounds().width()),this.addClass("js-touch-item-view-filter"),f&&this.filter().get("dropShadow").setRadius(10).setColor(0)),this._commit()},respondsToTouchGesture:function(t){return t.type!=e.GestureType.DRAG?!1:this._verticalLayout&&t.scrollX&&t.distanceX>0||!this._verticalLayout&&t.scrollY},setVerticalLayout:function(){this._verticalLayout=!0,this.setParams((new n).fillParentHeight().matchParentWidth())},setHorizontalLayout:function(){this._verticalLayout=!1,this.setParams((new n).fillParentWidth().matchParentHeight())}});return h}),define("views/touch-list-view",["views/app-card-view","mobileui/ui/list-view","mobileui/views/layout-params","app"],function(e,t,n,r){var i=e.extend({initialize:function(e){i.__super__.initialize.call(this),this._listView=(new t).matchParentSize().setItemRendererFactory(this._onItemRendererFactory.bind(this)).setCollection(this.model).setScrollDirection("none"),this._listView.contentView().matchParentSize(),this.append(this._listView.render()),this.on("activate",this._onActivate,this),this.on("deactivate",this._onDeactivate,this),this._useVerticalLayout=null,this.animation(),this.transform().clear()},listView:function(){return this._listView},render:function(){return this.$el.addClass("js-touch-list-view"),i.__super__.render.call(this)},_onItemSelected:function(e){var t=this,n=this._listView.indexOfView(e);this.model.each(function(r,i){var s=t._listView.itemView(r);if(!s||s==e)return;s.animateViewSwitch(Math.abs(n-i))})},_onActivate:function(e){if(!e.goingBack)return;var t=this,n=[];this.model.each(function(e,r){var i=t._listView.itemView(e);i&&n.push(i.startAnimations(r))}),e.promise=$.when.apply(null,n)},_onDeactivate:function(){var e=this;this.model.each(function(t){var n=e._listView.itemView(t);n&&n.resetAnimations()})},setUseVerticalLayout:function(e){if(this._useVerticalLayout==e)return;e?this.setVerticalLayout():this.setHorizontalLayout()},_internalShouldUseVerticalLayout:function(){return!0},layout:function(){this.setUseVerticalLayout(this._internalShouldUseVerticalLayout()),i.__super__.layout.call(this)},setVerticalLayout:function(){this._useVerticalLayout=!0;var e=this;this.model.each(function(t){var n=e._listView.itemView(t);if(!n)return;n.setVerticalLayout()}),this._listView.contentView().setLayout("vertical")},setHorizontalLayout:function(){this._useVerticalLayout=!1;var e=this;this.model.each(function(t){var n=e._listView.itemView(t);if(!n)return;n.setHorizontalLayout()}),this._listView.contentView().setLayout("horizontal")}});return i}),define("cards/splash-view",["views/touch-item-view","views/touch-list-view","app"],function(e,t,n){var r=[{label:"LA",className:"js-la-item-view"}],i=e.extend({initialize:function(){i.__super__.initialize.call(this),this.$labelEl.addClass("js-splash-item-view-label")},render:function(){return i.__super__.render.call(this),this.filterView().$el.addClass("js-splash-item-view"),this},_onTapStart:function(){if(n.mainView.navigatorView().nextCard())return;n.mainView.navigatorView().prepareNextCard(n.router.lookupCard("City View"))}}),s=t.extend({isDefaultScreen:!0,initialize:function(e){this.model=new Backbone.Collection,this.model.add(_.map(r,function(e){return new Backbone.Model(e)})),s.__super__.initialize.call(this)},url:function(){return"card/"+encodeURIComponent("Splash View")},render:function(){return this.$el.addClass("js-splash-view"),s.__super__.render.call(this)},_onItemRendererFactory:function(e){return(new i({model:e})).render().on("selected",this._onItemSelected,this)},_internalShouldUseVerticalLayout:function(){return!1}});return{label:"Splash View",view:s}}),define("cards/city-view",["views/touch-item-view","views/touch-list-view","app"],function(e,t,n){var r=[{label:"Mood",className:"js-mood-item-view"},{label:"Location",className:"js-location-item-view"},{label:"Search",className:"js-search-item-view"}],i=e.extend({initialize:function(){i.__super__.initialize.call(this),this.$labelEl.addClass("js-city-item-view-label")},render:function(){return i.__super__.render.call(this),this.filterView().$el.addClass("js-city-item-view"),this},_onTapStart:function(){if(n.mainView.navigatorView().nextCard())return;n.mainView.navigatorView().prepareNextCard(n.router.lookupCard("Mood View"))}}),s=t.extend({initialize:function(e){this.model=new Backbone.Collection,this.model.add(_.map(r,function(e){return new Backbone.Model(e)})),s.__super__.initialize.call(this)},url:function(){return"card/"+encodeURIComponent("City View")},render:function(){return this.$el.addClass("js-city-view"),s.__super__.render.call(this)},_onItemRendererFactory:function(e){return(new i({model:e})).render().on("selected",this._onItemSelected,this)},_internalShouldUseVerticalLayout:function(){return this.layoutBounds(),this.bounds().width()<550}});return{label:"City View",view:s}}),define("cards/mood-view",["views/touch-item-view","views/touch-list-view","app"],function(e,t,n){var r=[{label:"Do",className:"js-do-item-view",hue:180,saturation:23},{label:"See",className:"js-see-item-view",hue:283,saturation:15},{label:"Buy",className:"js-buy-item-view",hue:6,saturation:53},{label:"Eat",className:"js-eat-item-view",hue:53,saturation:54}],i=e.extend({initialize:function(){i.__super__.initialize.call(this),this.$labelEl.addClass("js-mood-item-view-label"),this.useFoldingFilters()},render:function(){return i.__super__.render.call(this),this.filterView().$el.addClass("js-mood-item-view"),this},_onTapStart:function(){if(n.mainView.navigatorView().nextCard())return;n.mainView.navigatorView().prepareNextCard(n.router.lookupCard("Locations View",this.model.get("hue")+":"+this.model.get("saturation")))}}),s=t.extend({initialize:function(e){this.model=new Backbone.Collection,this.model.add(_.map(r,function(e){return new Backbone.Model(e)})),s.__super__.initialize.call(this)},url:function(){return"card/"+encodeURIComponent("Mood View")},render:function(){return this.$el.addClass("js-mood-view"),s.__super__.render.call(this)},_onItemRendererFactory:function(e){return(new i({model:e})).render().on("selected",this._onItemSelected,this)}});return{label:"Mood View",view:s}}),define("cards/locations-view",["views/touch-item-view","views/touch-list-view","mobileui/views/layout-params","app"],function(e,t,n,r){var i=[{label:"The Abbey (club)"},{label:"Alameda Corridor"},{label:"Alex Theatre"},{label:"Ambassador Hotel (Los Angeles)"},{label:"Amoeba Music"},{label:"Andaz West Hollywood"},{label:"Anderton Court Shops"},{label:"Angels Flight"},{label:"Angelus Temple"},{label:"Los Angeles Aqueduct"},{label:"ArcLight Hollywood"},{label:"Avalon Hollywood"},{label:"Avenel Cooperative Housing Project"},{label:"The Abbey (club)"}],s=e.extend({initialize:function(e){_.extend(this,e),s.__super__.initialize.call(this),this.$labelEl.addClass("js-location-item-view-label"),this.useFoldingFilters()},setVerticalLayout:function(){this._verticalLayout=!0,this.setParams((new n).matchParentWidth()),this.bounds().setHeight(100)},render:function(){return s.__super__.render.call(this),this.filterView().$el.addClass("js-location-item-view").css("background-color","hsl("+this.hue+", "+this.saturation+"%, "+Math.min(100,28+this.model.get("index")*2)+"%)"),this},_onTapStart:function(){if(r.mainView.navigatorView().nextCard())return;r.mainView.navigatorView().prepareNextCard(r.router.lookupCard("Location View"))}}),o=t.extend({initialize:function(e){this.hue=283,this.saturation=15;if(e&&e.path){var t=e.path.split(":");this.hue=parseInt(t[0],10),this.saturation=parseInt(t[1],10)}this.model=new Backbone.Collection,this.model.add(_.map(i,function(e,t){return(new Backbone.Model(e)).set("index",t)})),o.__super__.initialize.call(this),this.listView().setScrollDirection("vertical"),this.listView().contentView().setParams((new n).matchParentWidth().matchChildrenHeight()),this.setVerticalLayout(),this.on("activate",this._onViewActivated,this),this.on("deactivate",this._onViewDeactivated,this)},url:function(){return"card/"+encodeURIComponent("Locations View")+"/"+this.hue+":"+this.saturation},_onViewActivated:function(){r.mainView.navigatorView().listButton().show(),r.mainView.navigatorView().gridButton().show()},_onViewDeactivated:function(){r.mainView.navigatorView().listButton().hide(),r.mainView.navigatorView().gridButton().hide()},render:function(){return this.$el.addClass("js-locations-view"),o.__super__.render.call(this)},_onItemRendererFactory:function(e){return(new s({model:e,hue:this.hue,saturation:this.saturation})).render().on("selected",this._onItemSelected,this)}});return{label:"Locations View",view:o}}),define("cards/location-view",["views/app-card-view","app"],function(e,t){var n=e.extend({initialize:function(e){n.__super__.initialize.call(this)},render:function(){return this.$el.addClass("js-location-view").append("Location view"),n.__super__.render.call(this)},url:function(){return"card/"+encodeURIComponent("Location View")}});return{label:"Location View",view:n}}),define("cards/list",["cards/splash-view","cards/city-view","cards/mood-view","cards/locations-view","cards/location-view"],function(){return _.toArray(arguments)}),define("mobileui/ui/scroll-card-view",["mobileui/ui/navigator-card-view","mobileui/views/scroll-view"],function(e,t){var n=e.extend({initialize:function(){n.__super__.initialize.call(this),this._scrollView=(new t).matchParentSize().setScrollDirection(t.VERTICAL),this.append(this._scrollView.render())},render:function(){return this.$el.addClass("js-scroll-card-view"),n.__super__.render.call(this)},scrollView:function(){return this._scrollView}});return n}),define("mobileui/ui/button-view",["mobileui/views/gesture-view"],function(e){var t=e.extend({initialize:function(){t.__super__.initialize.call(this),this._label="Button",this.bounds().setSize(70,40),this.on("tapstart",this._onTapStart,this),this.on("tapend",this._onTapEnd,this),this._state="up",this._prevState=null,this.$labelEl=$("<div />").addClass("js-button-view-label")},setLabel:function(e){return this._label=e,this.invalidate("label"),this},render:function(){return t.__super__.render.call(this),this.$el.addClass("js-button-view").append(this.$labelEl),this._validateLabel(),this._validateState(),this},_validateLabel:function(){this.$labelEl.text(this._label)},_validateState:function(){this._prevState&&this.$el.removeClass("js-button-view-"+this._prevState),this.$el.addClass("js-button-view-"+this._state),this._prevState=this._state},_onTapStart:function(){this._state="down",this.invalidate("state")},_onTapEnd:function(){this._state="up",this.invalidate("state")}});return t}),define("mobileui/ui/navigator-top-bar-view",["mobileui/views/layout-view","mobileui/views/layout-params","mobileui/ui/button-view"],function(e,t,n){var r=e.extend({initialize:function(){r.__super__.initialize.call(this),this.bounds().setHeight(r.height),this.setParams((new t).matchParentWidth()),this.setLayout("horizontal")},render:function(){return this.$el.addClass("js-navigator-top-bar-view"),r.__super__.render.call(this)}});return _.extend(r,{height:50}),r}),define("mobileui/ui/navigator-content-view",["mobileui/views/layer-view","mobileui/views/layout-params"],function(e,t){var n=e.extend({initialize:function(){n.__super__.initialize.call(this),this.setParams((new t).matchParentWidth().fillParentHeight())},render:function(){return this.$el.addClass("js-navigator-content-view"),n.__super__.render.call(this)}});return n}),define("mobileui/ui/navigator-view",["mobileui/views/layout-view","mobileui/views/layout-params","mobileui/ui/navigator-top-bar-view","mobileui/ui/navigator-content-view"],function(e,t,n,r){var i=e.extend({initialize:function(){i.__super__.initialize.call(this),this.matchParentSize().setLayout("vertical"),this._topBarView=new n,this.append(this._topBarView.render()),this._contentView=new r,this.append(this._contentView.render()),this._historyCards=[],this._activeCard=null,this._nextCard=null,this._precommitCard=null,this._wasLastHistoryCard=!1},render:function(){return this.$el.addClass("js-navigator-view"),i.__super__.render.call(this)},topBarView:function(){return this._topBarView},contentView:function(){return this._contentView},activeCard:function(){return this._activeCard},nextCard:function(){return this._nextCard},canGoBack:function(){return this._historyCards.length>0},prepareHistoryCard:function(){var e=_.last(this._historyCards);return this.prepareNextCard(e)},prepareNextCard:function(e){return this._nextCard&&this.revertNextCard(),this._wasLastHistoryCard=!1,this._nextCard=e,this._activeCard?this.contentView().before(this._nextCard,this._activeCard):this.contentView().append(this._nextCard),this._nextCard._setNavigatorView(this),this._nextCard.trigger("card:next"),this},_isLastHistoryCard:function(e){return _.last(this._historyCards)==this._nextCard},revertNextCard:function(){return this._precommitCard?this.commitNextCard():this._nextCard?(this._nextCard.trigger("card:revert"),this._nextCard._setNavigatorView(null),this._isLastHistoryCard(this._nextCard)?this._nextCard.detach():this._nextCard.remove(),this._nextCard=null,this._wasLastHistoryCard=!1,this):this},precommitNextCard:function(){return this._nextCard?(this._wasLastHistoryCard=this._isLastHistoryCard(this._nextCard),this._wasLastHistoryCard?this._historyCards.pop():this._historyCards.push(this._activeCard),this._precommitCard=this._activeCard,this._activeCard=this._nextCard,this._nextCard=null,this._activeCard.trigger("card:precommit"),this):this},commitNextCard:function(){return this._precommitCard&&(this._precommitCard.trigger("deactivate"),this._precommitCard._setNavigatorView(null),this._wasLastHistoryCard?this._precommitCard.remove():this._precommitCard.detach(),this._precommitCard=null),this._activeCard.trigger("card:commit"),this._activeCard.trigger("activate",{goingBack:!1}),this},resetCard:function(e){this.revertNextCard();var t=this._activeCard;this._activeCard&&(this._activeCard.trigger("deactivate"),this._activeCard=null);var n={goingBack:!1,promise:null};e&&(this._activeCard=e,this._activeCard._setNavigatorView(this),this._activeCard.trigger("activate",n),this._contentView.append(e)),t&&(n.promise?n.promise.then(function(){t._setNavigatorView(null).remove()}):t._setNavigatorView(null).remove())},pushCard:function(e){this.revertNextCard();var t=this._activeCard;this._activeCard&&(this._activeCard.trigger("deactivate"),this._historyCards.push(this._activeCard),this._activeCard=null);var n={goingBack:!1,promise:null};e&&(this._activeCard=e,this._activeCard._setNavigatorView(this),this._activeCard.trigger("activate",n),this._contentView.append(e)),t&&(n.promise?n.promise.then(function(){t._setNavigatorView(null).detach()}):t._setNavigatorView(null).detach())},popCard:function(){this.revertNextCard();var e=this._activeCard;this._activeCard&&(this._activeCard.trigger("deactivate"),this._activeCard=null);if(this._historyCards.length){var t={goingBack:!0,promise:null};this._activeCard=this._historyCards.pop(),this._contentView.append(this._activeCard),this._activeCard._setNavigatorView(this),this._activeCard.trigger("activate",t),e&&(t.promise?t.promise.then(function(){e._setNavigatorView(null).remove()}):e._setNavigatorView(null).remove())}else e&&e._setNavigatorView(null).remove();return this._activeCard}});return i}),define("tests/old-test",["mobileui/ui/scroll-card-view","mobileui/ui/navigator-view","mobileui/views/layer-view","mobileui/views/gesture-view","mobileui/views/measured-view","mobileui/views/layout-view","mobileui/views/scroll-view","mobileui/utils/transform","mobileui/utils/transform-animation","mobileui/views/layout-params","app"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.extend({initialize:function(){c.__super__.initialize.call(this),this.on("activate",this._onViewActivated,this)},_onViewActivated:function(){l.router.navigate("test/"+encodeURIComponent("Old test"),{trigger:!1})},render:function(){c.__super__.render.call(this),this.$el.addClass("js-old-test-view");var e=this,t=(new s).setParams((new f).matchChildren());this.scrollView().setContentView(t),t.setLayout("vertical");var u=new s;u.setLayout("vertical"),u.bounds().setSize(100,300);var a=new n;a.bounds().setSize(90,50),a.render().$el.addClass("red-box").html("Inside of the first layer"),u.append(a);var l=new r;l.setParams((new f).fillParentHeight()).bounds().setWidth(90),l.render().$el.addClass("green-box").html("Inside of the second layer"),u.append(l),l.on("tap",function(){e.scrollView().setScrollDirection(o.VERTICAL),t.setLayoutWithAnimation("vertical")});var h=new n;h.bounds().setSize(90,50),h.render().$el.addClass("red-box").html("Inside of the third layer"),u.append(h);var p=new r;t.append(u.render().addClass("blue-box")).append(p.render().addClass("red-box")),p.bounds().setWidth(200).setHeight(100),p.on("tap",function(){e.scrollView().setScrollDirection(o.HORIZONTAL),t.setLayoutWithAnimation("horizontal")});var d=new s;d.setLayout("vertical").addGestureDetector(),d.bounds().setX(100),t.append(d.render().addClass("red-box")),d.setParams((new f).matchChildren()),d.append((new i).render().setContent("Line 1")),d.append((new i).render().setContent("Line 2 is super long")),d.append((new i).render().setContent("Line 3")),d.append((new i).render().setContent("Line 4")),d.padding().setLeft(100).setTop(50).setBottom(10).setRight(60);var v;d.animation().chain(10),d.animation().start().once("stop",function(){var e=new i;t.beforeWithAnimation(e.render().addClass("green-box"),u),e.setContent("Box of the right size"),v=new i,t.beforeWithAnimation(v.render().addClass("green-box"),d),v.setContent("Box of the right size<br /> - test")}),d.on("tap",function(){if(!v)return;v.parent()?v.detachWithAnimation():t.beforeWithAnimation(v,d)});var m=(new o).setScrollDirection(o.VERTICAL);m.setContentView((new s).render().setLayout("vertical")),m.contentView().setParams((new f).matchChildrenHeight()).append((new i).render().setContent("Item 1")).append((new i).render().setContent("Item 2")).append((new i).render().setContent("Item 3")).append((new i).render().setContent("Item 4")).append((new i).render().setContent("Item 6")).append((new i).render().setContent("Item 7")).append((new i).render().setContent("Item 8")).append((new i).render().setContent("Item 9")),m.$el.addClass("green-box"),m.bounds().setSize(100,100),m.scrollTo(0,100),t.append(m.render());var g=(new o).setScrollDirection(o.HORIZONTAL);return g.setContentView((new s).render().setLayout("horizontal")),g.contentView().setParams((new f).matchChildrenWidth()).append((new i).render().setContent("Item 1")).append((new i).render().setContent("Item 2")).append((new i).render().setContent("Item 3")).append((new i).render().setContent("Item 4")).append((new i).render().setContent("Item 6")).append((new i).render().setContent("Item 7")).append((new i).render().setContent("Item 8")).append((new i).render().setContent("Item 9")),g.$el.addClass("green-box"),g.bounds().setSize(100,100),g.scrollTo(100,0),t.append(g.render()),this}});return{label:"Old test",view:c}}),define("tests/list",["tests/old-test"],function(){return _.toArray(arguments)}),define("views/index-view",["views/app-card-view","mobileui/ui/list-view","mobileui/views/layout-params","mobileui/views/measured-view","cards/list","tests/list","app"],function(e,t,n,r,i,s,o){var u=r.extend({initialize:function(){u.__super__.initialize.call(this),this.addGestureDetector(),this.on("tap",this._onTap,this),this.setParams((new n).matchParentWidth()),this.listenTo(this.model,"change:label",this._onLabelChanged),this.padding().setAll(10)},render:function(){return u.__super__.render.call(this),this.$el.addClass("js-item-view"),this._onLabelChanged(),this},_onLabelChanged:function(){this.setTextContent(this.model.get("label"))},_onTap:function(){this.trigger("selected",this.model)}}),a=e.extend({initialize:function(e){a.__super__.initialize.call(this),this.model=new Backbone.Collection,this.model.add(_.map(i,function(e){return new Backbone.Model(e)})),this.model.add(_.map(s,function(e){return new Backbone.Model(e)}))},render:function(){return this.$el.addClass("js-index-view"),this._listView=(new t).matchParentSize().setItemRendererFactory(this._onItemRendererFactory.bind(this)).setCollection(this.model),this.append(this._listView.render()),a.__super__.render.call(this)},_onItemRendererFactory:function(e){return(new u({model:e})).render().on("selected",this._onItemSelected,this)},_onItemSelected:function(e){o.mainView.navigatorView().pushCard(o.router.lookupCard(e.get("label")))},url:function(){return"/"}});return a}),define("router",["app","views/index-view","cards/list","tests/list"],function(e,t,n,r){var i=Backbone.Router.extend({routes:{"card/*path/*options":"card","card/*path":"card",index:"index","*path":"defaultHandler"},defaultHandler:function(){var n=this.lookupCard(e.defaultCard);e.mainView.navigatorView().resetCard(n?n:(new t).render())},index:function(){e.mainView.navigatorView().pushCard((new t).render())},card:function(n,r){var i=this.lookupCard(decodeURIComponent(n),decodeURIComponent(r));e.mainView.navigatorView().resetCard(i?i:(new t).render())},lookupCard:function(e,t){var i=_.find(n,function(t){return t.label==e});if(!i){i=_.find(r,function(t){return t.label==e});if(!i)return null}var s=i.view;if(!s)return null;var o=(new s({path:t})).render();return o}}),s=e.router=new i;return e.on("start",function(){Backbone.history.start({})}),s}),define("mobileui/ui/window-view",["mobileui/views/layout-view"],function(e){var t=e.extend({initialize:function(){t.__super__.initialize.call(this),$(window).on("resize",this._onWindowResize.bind(this)),this._onWindowResize()},render:function(){return this.$el.addClass("js-window-view"),t.__super__.render.call(this)},_onWindowResize:function(){this.bounds().setSize(window.innerWidth,window.innerHeight),this.setNeedsLayout(!0)}});return t}),define("utils/cache",["mobileui/utils/boilerplate"],function(e){var t=function(){this._cache=e.lookupPrefix(window,"applicationCache");if(!this._cache)return;this._cache.addEventListener("updateready",this._onCacheUpdateReady.bind(this))};return _.extend(t.prototype,Backbone.Events,{_onCacheUpdateReady:function(){if(this._cache.status!=this._cache.UPDATEREADY){console.log("No cache update.");return}console.log("Update ready."),this.trigger("updateready")},swapCache:function(){console.log("Swapping cache."),this.cache.swapCache(),console.log("Reloading app."),window.location.reload()},checkForUpdates:function(){if(!this.cache)return;try{this._cache.update()}catch(e){}}}),new t}),define("views/app-navigator-view",["mobileui/ui/navigator-view","mobileui/ui/button-view","utils/cache","app"],function(e,t,n,r){var i=e.extend({initialize:function(){i.__super__.initialize.call(this),this.addTopBarButtons()},render:function(){return this.$el.addClass("js-app-navigator-view"),i.__super__.render.call(this)},addTopBarButtons:function(){var e=this.topBarView();this._backButton=(new t).setLabel("Back").on("tap",this._onBackButtonTap,this),this._backButton.margin().setLeft(10).setTop(5),e.append(this._backButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-back-button-view")),this._homeButton=(new t).setLabel("Home").on("tap",this._onBackButtonTap,this),this._homeButton.margin().setLeft(10).setTop(5),e.append(this._homeButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-home-button-view")),this._refreshButton=(new t).setLabel("Refresh").on("tap",this._onRefreshButtonTap,this),this._refreshButton.margin().setLeft(10).setTop(5),e.append(this._refreshButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-refresh-button-view")),this._updateButton=(new t).setLabel("Update").on("tap",this._onUpdateButtonTap,this),this._updateButton.margin().setLeft(10).setTop(5),e.append(this._updateButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-update-button-view")),e.appendFiller(),this._listButton=(new t).setLabel("List").hide(),this._listButton.margin().setRight(10).setTop(5),e.append(this._listButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-list-button-view")),this._gridButton=(new t).setLabel("Grid").hide(),this._gridButton.margin().setRight(10).setTop(5),e.append(this._gridButton.render().addClass("js-navigator-top-bar-button-view").addClass("js-navigator-top-bar-grid-button-view"))},backButton:function(){return this._backButton},homeButton:function(){return this._homeButton},updateBackButton:function(){this.canGoBack()?(this._backButton.show(),this._homeButton.hide(),this._refreshButton.hide()):(this._backButton.hide(),this.activeCard().isDefaultScreen?(this._homeButton.hide(),this._refreshButton.show()):(this._homeButton.show(),this._refreshButton.hide()))},listButton:function(){return this._listButton},gridButton:function(){return this._gridButton},_onBackButtonTap:function(){this.popCard()||this.pushCard(r.router.lookupCard(r.defaultCard))},_onRefreshButtonTap:function(){window.location.reload()},_onUpdateButtonTap:function(){n.checkForUpdates()}});return i}),define("views/main-view",["app","mobileui/ui/window-view","views/app-navigator-view","utils/cache"],function(e,t,n,r){var i=t.extend({initialize:function(){i.__super__.initialize.call(this),this._navigatorView=new n,this.append(this._navigatorView.render()),this.listenTo(r,"updateready",this._onUpdateReady)},render:function(){return i.__super__.render.call(this),this.$el.addClass("js-main-view"),this},navigatorView:function(){return this._navigatorView},_onUpdateReady:function(){confirm("New application version is available. Would you like to load the new version now?")&&r.swapCache()}});return e.on("init",function(){e.mainView=(new i({el:$("#main").get(0)})).render()}),i}),define("main",["app","router","views/main-view"],function(e){$(function(){e.trigger("init"),e.trigger("start")})});